(window.webpackJsonp=window.webpackJsonp||[]).push([["planManagement"],{"058f":function(e,t,a){"use strict";a("67e5")},"098c":function(e,t,a){},"3a3a":function(e,t,a){"use strict";function n(e,t){return{response:function(e,t){return{response:function(a){var n=a=a||{pageIndex:1,pageSize:20},r=n.pageIndex,o=n.pageSize;return e&&e(r,o,t)}}}(e,t).response}}a.d(t,"a",(function(){return n}))},"506b":function(e,t,a){"use strict";a("098c")},"67e5":function(e,t,a){},b19c:function(e,t,a){"use strict";a.r(t);var n=a("1da1"),r=(a("b0c0"),a("caad"),a("ac1f"),a("5319"),a("96cf"),a("7a23")),o=a("c252"),c=a("3a3a"),l=a("5530"),u=a("79f6"),i=a("b23d");function d(e){return u.a.get(i.a.getPlanLists,e)}function s(){return f.apply(this,arguments)}function f(){return(f=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:1,a=r.length>1&&void 0!==r[1]?r[1]:20,n=r.length>2?r[2]:void 0,e.next=5,d(Object(l.a)(Object(l.a)({},n),{},{pageIndex:t,pageSize:a}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a("4de4"),a("d81d");var p=a("38d1"),m=a("eaf6"),b={class:"rp-relative-dialog"},v={class:"relative-dialog"},O=Object(r.createElementVNode)("p",null,"关联需求",-1),j={class:"content-demand-list"},_={style:{"font-size":"14px"},class:"el-tree-node__label node-name"},g=Object(r.createElementVNode)("p",null,"备注",-1),h={class:"dialog-footer"},y=Object(r.createTextVNode)("取 消"),w=Object(r.createTextVNode)("确 定"),k=Object(r.defineComponent)(Object(l.a)(Object(l.a)({},{name:"dialog-plan"}),{},{props:{visible:{type:Boolean,default:!1},sortTreeDate:{type:Object,default:function(){return{}}},defaultCheck:{type:Array,default:function(){return[]}},planPeople:{type:Array,default:function(){return[]}},placeholder:{type:String,default:"计划名称，2-50字"},dialogForm:{type:Object,default:function(){return{}}},planIds:{ype:Array,default:function(){return[]}}},emits:["update:visible","update"],setup:function(e,t){var a=t.emit,o=e,c=Object(m.a)().tipMessage,l=Object(r.ref)(),u=Object(r.ref)(),i=Object(r.reactive)({name:[{required:!0,message:"请输入计划名称",trigger:"blur"},{min:2,max:50,message:"请输入2-50个字符",trigger:"blur"}]}),d=Object(r.computed)({get:function(){return o.visible},set:function(e){a("update:visible",e)}}),s=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.validate((function(e,t){if(e){var n=o.planPeople.filter((function(e){return e.staff_no===o.dialogForm.staff_no}));if(n&&n.length?o.dialogForm.staff_name=n[0].staff_name:(o.dialogForm.staff_no="",o.dialogForm.staff_name=""),o.dialogForm.demand_ids=l.value.getCheckedKeys(!1),o.dialogForm.end_time&&o.dialogForm.start_time&&o.dialogForm.end_time<o.dialogForm.start_time)return c(400,"开始时间不能大于结束时间");o.dialogForm.id?Object(p.cb)(o.dialogForm).then((function(e){200===e.code&&a("update")})):Object(p.g)(o.dialogForm).then((function(e){200===e.code&&a("update")}))}}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(e,t){o.dialogForm.demand_ids=t.checkedKeys},k=Object(r.computed)((function(){return o.sortTreeDate.map((function(e){return Object.assign(e,{})}))})),C=function(){a("update:visible",!1)};return function(t,a){var n=Object(r.resolveComponent)("el-input"),o=Object(r.resolveComponent)("el-form-item"),c=Object(r.resolveComponent)("el-option"),p=Object(r.resolveComponent)("el-select"),m=Object(r.resolveComponent)("el-date-picker"),x=Object(r.resolveComponent)("el-form"),V=Object(r.resolveComponent)("el-tree"),N=Object(r.resolveComponent)("el-button"),F=Object(r.resolveComponent)("el-dialog");return Object(r.openBlock)(),Object(r.createElementBlock)("div",b,[Object(r.createVNode)(F,{top:"8vh",title:e.dialogForm.id?"编辑计划":"新增计划",modelValue:Object(r.unref)(d),"onUpdate:modelValue":a[7]||(a[7]=function(e){return Object(r.isRef)(d)?d.value=e:null}),onClose:C,width:"40%"},{footer:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("span",h,[Object(r.createVNode)(N,{onClick:a[5]||(a[5]=function(e){return d.value=!1})},{default:Object(r.withCtx)((function(){return[y]})),_:1}),Object(r.createVNode)(N,{type:"primary",onClick:a[6]||(a[6]=function(e){return s(u.value)})},{default:Object(r.withCtx)((function(){return[w]})),_:1})])]})),default:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("div",v,[Object(r.createVNode)(x,{"label-position":"top",rules:Object(r.unref)(i),ref_key:"ruleFormRef",ref:u,model:e.dialogForm,class:"plan-form-inline"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(o,{label:"计划名称",prop:"name"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(n,{style:{width:"92%"},modelValue:e.dialogForm.name,"onUpdate:modelValue":a[0]||(a[0]=function(t){return e.dialogForm.name=t}),placeholder:"计划名称，2-50字"},null,8,["modelValue"])]})),_:1}),Object(r.createVNode)(o,{label:"负责人"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(p,{style:{width:"92%"},modelValue:e.dialogForm.staff_no,"onUpdate:modelValue":a[1]||(a[1]=function(t){return e.dialogForm.staff_no=t}),clearable:"",filterable:"",placeholder:"请选择负责人"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(e.planPeople,(function(e){return Object(r.openBlock)(),Object(r.createBlock)(c,{label:e.staff_name,value:e.staff_no,key:e.staff_no},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(r.createVNode)(o,{label:"开始时间"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(m,{style:{width:"92%"},size:"default",modelValue:e.dialogForm.start_time,"onUpdate:modelValue":a[2]||(a[2]=function(t){return e.dialogForm.start_time=t}),teleported:!1,"value-format":"YYYY-MM-DD",placeholder:"结束时间"},null,8,["modelValue"])]})),_:1}),Object(r.createVNode)(o,{label:"结束时间"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(m,{style:{width:"92%"},size:"default",modelValue:e.dialogForm.end_time,"onUpdate:modelValue":a[3]||(a[3]=function(t){return e.dialogForm.end_time=t}),teleported:!1,"value-format":"YYYY-MM-DD",placeholder:"结束时间"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["rules","model"]),O,Object(r.createElementVNode)("div",j,[Object(r.createVNode)(V,{data:Object(r.unref)(k),"node-key":"id",ref_key:"classifyTree",ref:l,"default-checked-keys":e.dialogForm.demand_ids,"show-checkbox":"",onCheck:f,"default-expand-all":!0,props:{children:"children",label:"name"}},{default:Object(r.withCtx)((function(e){var t=e.node;return[Object(r.createElementVNode)("span",_,Object(r.toDisplayString)(t.label),1)]})),_:1},8,["data","default-checked-keys"])]),g,Object(r.createVNode)(n,{class:"plan-remark",maxlength:"500","show-word-limit":"",rows:4,modelValue:e.dialogForm.remark,"onUpdate:modelValue":a[4]||(a[4]=function(t){return e.dialogForm.remark=t}),type:"textarea"},null,8,["modelValue"])])]})),_:1},8,["title","modelValue"])])}}}));a("506b");var C=k,x=a("d257"),V=a("6669"),N=a("81ab"),F=a("6c02"),I=a("6b59"),R={class:"rp-plan-management"},D={class:"search-header"},S=Object(r.createTextVNode)("新增计划"),B=["onClick"],P=["onClick"],E=["onClick"],T={key:0},A={key:1},J=Object(r.createTextVNode)("编辑"),z=Object(r.createTextVNode)("删除"),G=Object(r.defineComponent)({setup:function(e){var t,a=Object(F.f)(),l=Object(F.e)(),u=Object(x.G)("user",!0),i=Object(r.ref)(1),d=Object(r.ref)(!1),f=Object(x.G)("productInfo",!0),m=Object(r.ref)({name:"",create_by:[],staff_no:[],status:[],times:[],start_time:"",end_time:"",sort_name:"",sort_by:0,product_id:null==f?void 0:f.id}),b={name:"",create_by:[],staff_no:[],status:[],times:[],start_time:"",end_time:"",sort_name:"",sort_by:0,product_id:null==f?void 0:f.id},v=Object(r.reactive)({list:[],total:0}),O=Object(r.reactive)({name:"",start_time:"",end_time:"",remark:"",create_by:"",creator:"",staff_no:"",staff_name:"",product_id:null,id:null,demand_ids:[]}),j=Object(r.ref)("新增计划"),_=Object(r.ref)(!1),g=Object(r.ref)("-1"),h=Object(r.ref)([4,5]),y=Object(r.ref)([]),w=Object(r.ref)(),k=Object(r.ref)(!1),G=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,a,n){var r,l,u,d,f,p,b,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.value=null!=a,i.value=t&&t.pageIndex||1,r=Object(c.a)(s,n||m.value),l=r.response,u=Object(o.a)(l),d=u.pagation,e.next=6,d(t);case 6:f=e.sent,p=f.data,b=p.list,O=p.count,v.total=O,v.list=b;case 12:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),q=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m.value.product_id){e.next=2;break}return e.abrupt("return");case 2:clearTimeout(t),t=setTimeout(Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.value){e.next=8;break}return w.value.setCurrentPage(),i.value=1,e.next=5,G({pageIndex:1,pageSize:20},!0,m.value);case 5:d.value=!1,e.next=10;break;case 8:return e.next=10,G(null===(t=w.value)||void 0===t?void 0:t.getCurrentPage(),!0,m.value);case 10:k.value=!1;case 11:case"end":return e.stop()}}),e)}))),300);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(N.t)(t);case 2:a=e.sent,(n=a.data)&&n.length?y.value=n:y.value=[];case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r.onMounted)((function(){q()}));var Y=function(){_.value=!1,G(w.value.getCurrentPage(),void 0,m.value)},M=function(e){var t=e.prop,a=e.order;a&&(m.value.sort_name=t,m.value.sort_by="ascending"===a?1:2,G(w.value.getCurrentPage(),void 0,m.value))},K=function(e){var t=Object(x.G)("productInfo",!0);if(m.value=JSON.parse(JSON.stringify(b)),m.value.product_id=t.id,e.key){var a={status:["3"],create_by:[null==u?void 0:u.staff_no],staff_no:[null==u?void 0:u.staff_no]},n={};n.product_id=m.value.product_id,n[e.key]=a[e.key],m.value[e.key]=n[e.key]}d.value=!0,H()},L=function(e){var t=JSON.parse(JSON.stringify(e));for(var a in t.product_id=m.value.product_id,e)m.value[a]=e[a];m.value.times&&m.value.times.length?(m.value.start_time=m.value.times[0],m.value.end_time=m.value.times[1]):(m.value.start_time="",m.value.end_time=""),H()},H=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.value=!0,q();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=Object(r.ref)([]),W=Object(r.ref)([]),X=Object(r.ref)([]),Z=function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(x.G)("productInfo",!0),e.next=3,U({product_id:null==a?void 0:a.id,filter_type:1});case 3:for(n in O)["id","demand_ids","staff_name","staff_no"].includes(n)?("id"===n&&(O[n]=null),"demand_ids"===n&&(O[n]=[]),O.staff_name=(null==u?void 0:u.name)||"",O.staff_no=(null==u?void 0:u.staff_no)||""):O[n]="";O.demand_ids=t?X.value:[],O.product_id=null==a?void 0:a.id,_.value=!0;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();l.params.planIds&&l.params.planIds.length&&(X.value=l.params.planIds,O.demand_ids=l.params.planIds,Z("planIds"));var $=function(e,t,n){if(e){var r={id:t,where:"plan",type:[]};r.type=1===n?[8]:[],g.value="-10",a.push({name:"demandPool",query:r})}},ee=Object(r.ref)();Object(V.a)(q,function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.value.product_id!=t&&(m.value.product_id=0),m.value.product_id=t,e.next=4,q();case 4:(a=m.value.product_id)&&Object(p.e)({product_id:a}).then((function(e){e.data&&e.data.length?(Q.value=e.data,W.value=e.data[1].options):(Q.value=[],W.value=[])}));case 5:case"end":return e.stop()}var a}),e)})));return function(t){return e.apply(this,arguments)}}());var te=Object(r.reactive)({btnArray:[{id:"-1",label:"所有",key:""},{id:"5",label:"我创建的",key:"create_by"},{id:"6",label:"我负责的",key:"staff_no"},{id:"3",label:"未完成",key:"status"}],searchForm:[{type:"input",label:"名称",key:"name",val:""},{type:"select",label:"计划状态",val:[],multiple:!1,key:"status",listData:[{value:1,label:"未开始"},{value:2,label:"进行中"},{value:3,label:"未完成"},{value:4,label:"已完成"}]},{type:"select",label:"创建人",val:[],key:"create_by",showRecord:!0,multiple:!0,valueKey:["staff_no","staff_name"],listData:Q},{type:"select",label:"指派给",val:[],key:"staff_no",showRecord:!0,multiple:!0,valueKey:["staff_no","staff_name"],listData:Q},{type:"daterange",label:"预计开始",val:[],key:"times",valueKey:[]}]});return Object(r.watch)((function(){return l.query}),(function(e){if("demand"===e.where){var t=l.query,n=t.productId,r=t.plan_name,o=Object(x.G)("productInfo",!0);m.value=JSON.parse(JSON.stringify(b)),m.value.product_id=o.id,m.value.name=r,g.value="-10",te.searchForm[0].val=r,H(),a.replace({path:l.path,query:{productId:n,name:void 0,where:void 0}})}if("workbench"===e.where){var c=l.query,u=c.productId,i=c.name,d=Object(x.G)("productInfo",!0);m.value=JSON.parse(JSON.stringify(b)),m.value.product_id=d.id,m.value.name=i,g.value="-10",te.searchForm[0].val=i,H(),a.replace({path:l.path,query:{productId:u,name:void 0,where:void 0}})}}),{immediate:!0}),function(e,t){var n=Object(r.resolveComponent)("search-form"),o=Object(r.resolveComponent)("el-button"),c=Object(r.resolveComponent)("el-table-column"),l=Object(r.resolveComponent)("page-table");return Object(r.openBlock)(),Object(r.createElementBlock)("div",R,[Object(r.createVNode)(l,{tableData:Object(r.unref)(v).list,currentPage:i.value,onSortChange:M,onHandlePagationChange:G,total:Object(r.unref)(v).total,ref_key:"pageTableRef",ref:w,stopAutoGetData:k.value},{header:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("div",D,[Object(r.createVNode)(n,{searchArray:Object(r.unref)(te),ref_key:"planFormParams",ref:ee,currentActive:g.value,onQuickSeacrh:K,onChangeSearch:L},null,8,["searchArray","currentActive"]),Object(r.createVNode)(o,{type:"primary",onClick:t[0]||(t[0]=function(e){return Z("")})},{default:Object(r.withCtx)((function(){return[S]})),_:1})])]})),main:Object(r.withCtx)((function(){return[Object(r.createVNode)(c,{label:"计划名称",prop:"name","class-name":"table-column-left table-title",sortable:"custom","min-width":"140"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",{class:"app-name",onClick:function(t){return n=e.row,void a.push({name:"planDetail",query:{planId:n.id}});var n}},Object(r.toDisplayString)(e.row.name),9,B)]})),_:1}),Object(r.createVNode)(c,{label:"已上线需求/所有需求",prop:"total_num",sortable:"custom",width:"180"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",{onClick:function(t){return $(e.row.complete_num,e.row.id,1)},class:Object(r.normalizeClass)([e.row.complete_num?"demand-num":""])},Object(r.toDisplayString)(e.row.complete_num)+"/",11,P),Object(r.createElementVNode)("span",{onClick:function(t){return $(e.row.total_num,e.row.id,2)},class:Object(r.normalizeClass)([e.row.total_num?"demand-num":""])},Object(r.toDisplayString)(e.row.total_num),11,E)]})),_:1}),Object(r.createVNode)(c,{prop:"start_time",sortable:"custom",width:"300",label:"计划时间"},{default:Object(r.withCtx)((function(e){return[e.row.start_time||e.row.end_time?(Object(r.openBlock)(),Object(r.createElementBlock)("span",A,Object(r.toDisplayString)(e.row.start_time?e.row.start_time:"待定")+" - "+Object(r.toDisplayString)(e.row.end_time?e.row.end_time:"待定"),1)):(Object(r.openBlock)(),Object(r.createElementBlock)("span",T,"待定"))]})),_:1}),Object(r.createVNode)(c,{sortable:"custom",prop:"creator",width:"130",label:"创建人"}),Object(r.createVNode)(c,{sortable:"custom",prop:"staff_name",width:"130",label:"负责人"}),Object(r.createVNode)(c,{prop:"remark",label:"备注"}),Object(r.createVNode)(c,{label:"操作",width:"180"},{default:Object(r.withCtx)((function(e){return[Object(r.createVNode)(o,{type:"primary",link:"",onClick:function(t){return function(e){var t=Object(x.G)("productInfo",!0),a=e.create_by,n=e.remark,r=e.name,o=e.staff_no,c=e.creator,l=e.start_time,u=e.end_time,i=e.id,d=e.staff_name,s=e.demand_ids;U({product_id:null==t?void 0:t.id,with_plan_id:i}),O.name=r,O.start_time=l,O.end_time=u,O.remark=n,O.create_by=a,O.creator=c,O.staff_no=o,O.staff_name=d,O.id=i,O.demand_ids=s,_.value=!0}(e.row)}},{default:Object(r.withCtx)((function(){return[J]})),_:2},1032,["onClick"]),Object(r.createVNode)(o,{link:"",type:"danger",onClick:function(t){return a=e.row,void I.a.confirm("此操作将永久删除，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"el-button--danger-box",type:"warning"}).then((function(){Object(p.j)(a.id).then((function(){G(w.value.getCurrentPage(),!0,m.value)}))}));var a}},{default:Object(r.withCtx)((function(){return[z]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["tableData","currentPage","total","stopAutoGetData"]),_.value?(Object(r.openBlock)(),Object(r.createBlock)(C,{key:0,title:j.value,defaultCheck:h.value,visible:_.value,"onUpdate:visible":t[1]||(t[1]=function(e){return _.value=e}),onUpdate:Y,sortTreeDate:y.value,planPeople:W.value,dialogForm:Object(r.unref)(O),planIds:X.value},null,8,["title","defaultCheck","visible","sortTreeDate","planPeople","dialogForm","planIds"])):Object(r.createCommentVNode)("",!0)])}}}),q=(a("058f"),a("6b0d"));const U=a.n(q)()(G,[["__scopeId","data-v-f03bfdb6"]]);t.default=U},c252:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("1da1");function r(e){return{pagation:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(a);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}a("96cf")}}]);