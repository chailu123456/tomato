(window.webpackJsonp=window.webpackJsonp||[]).push([["member"],{11468:function(e,t,n){"use strict";n("bbc6")},"3a3a":function(e,t,n){"use strict";function r(e,t){return{response:function(e,t){return{response:function(n){var r=n=n||{pageIndex:1,pageSize:20},a=r.pageIndex,c=r.pageSize;return e&&e(a,c,t)}}}(e,t).response}}n.d(t,"a",(function(){return r}))},7676:function(e,t,n){"use strict";var r=n("7a23"),a=Object(r.defineComponent)({name:"Close"});const c={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},o=Object(r.createVNode)("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null,-1);a.render=function(e,t,n,a,u,i){return Object(r.openBlock)(),Object(r.createBlock)("svg",c,[o])},a.__file="packages/components/Close.vue",t.a=a},bbc6:function(e,t,n){},c252:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("1da1");function a(e){return{pagation:function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}n("96cf")},ca1b:function(e,t,n){"use strict";n("f884")},daf9:function(e,t,n){"use strict";n.r(t);var r=n("7a23"),a={class:"member"},c=Object(r.createTextVNode)("添 加"),o=Object(r.createTextVNode)("设为项目负责人"),u=Object(r.createTextVNode)("删除"),i={key:0,class:"load-container"},l=[function(e){return Object(r.pushScopeId)("data-v-31cf93e0"),e=e(),Object(r.popScopeId)(),e}((function(){return Object(r.createElementVNode)("div",{class:"load"},null,-1)}))],d={key:1},s={class:"dialog-footer"},f=Object(r.createTextVNode)("确 定"),b=n("5530"),p=n("1da1"),O=(n("159b"),n("4de4"),n("a434"),n("d81d"),n("caad"),n("2532"),n("96cf"),n("c252")),h=n("3a3a"),j=n("38d1");function v(){return m.apply(this,arguments)}function m(){return(m=Object(p.a)(regeneratorRuntime.mark((function e(){var t,n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:1,n=a.length>1&&void 0!==a[1]?a[1]:20,r=a.length>2?a[2]:void 0,e.next=5,Object(j.R)(Object(b.a)(Object(b.a)({},r),{},{pageIndex:t,pageSize:n}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=n("d257"),x=n("eaf6"),w=n("6c02"),k=n("6669"),_=n("9fe0"),C=n("6b59"),y=n("7676"),N=Object(r.defineComponent)({name:"member",components:{Close:y.a},setup:function(){var e,t,n,a,c=Object(r.ref)(1),o=Object(r.ref)(!1),u=Object(w.f)(),i=Object(x.a)().tipMessage,l=Object(r.reactive)({keyword:"",product_id:null===(e=Object(g.G)("productInfo",!0))||void 0===e?void 0:e.id}),d=Object(r.reactive)({list:[],total:0,can_opt_manager:!1}),s=Object(r.ref)(),f=Object(r.ref)(),m=Object(r.ref)(!1),y=function(){var e=Object(p.a)(regeneratorRuntime.mark((function e(t,n,r){var a,o,u,i,s,f,b,p,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.value=null!=n,c.value=t&&t.pageIndex||1,a=Object(h.a)(v,r||l),o=a.response,u=Object(O.a)(o),i=u.pagation,e.next=6,i(t);case 6:s=e.sent,f=s.data,b=f.list,p=f.count,j=f.can_opt_manager,d.total=p,d.list=b,d.can_opt_manager=j;case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),N=function(){var e=Object(p.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(n),n=setTimeout(Object(p.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.value){e.next=8;break}return f.value.setCurrentPage(),c.value=1,e.next=5,y({pageIndex:1,pageSize:20},!0,l);case 5:o.value=!1,e.next=10;break;case 8:return e.next=10,y(f.value.getCurrentPage(),!0,l);case 10:m.value=!1;case 11:case"end":return e.stop()}}),e)}))),300);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=Object(r.ref)([]),R=Object(r.ref)(),T=Object(r.ref)();N();var B=function(){clearTimeout(a),a=setTimeout(Object(p.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.value=[],V.value=[],e.next=4,Object(j.e)({product_id:null===(t=Object(g.G)("productInfo",!0))||void 0===t?void 0:t.id}).then((function(e){e.data&&e.data[1]&&(R.value=e.data[1].options,R.value.forEach((function(e){T.value.push(e),V.value.push(e.staff_no)})))}));case 4:return e.next=6,Object(_.e)().then((function(e){D.value=A(e.data,T.value),s.value=JSON.parse(JSON.stringify(D.value))}));case 6:case"end":return e.stop()}}),e)}))),300)};Object(k.a)(N,(function(e){l.product_id!=e&&(l.product_id=0),l.product_id=e,N(),B()}));var S=Object(r.ref)(!1),E=Object(r.ref)(),P=Object(r.ref)();Object(r.watch)((function(){return E.value}),(function(e){null==P||P.value.filter(e)})),Object(r.watch)((function(){return S.value}),(function(e){e||(D.value=[])}));var I=[],D=Object(r.ref)(),G=Object(r.ref)([]),A=function e(t,n){for(var r=[],a=function(a){var c={};c.id=t[a].id,c.label=t[a].label,c.disabled=!!t[a].is_department&&function(e,t,n){var r=[];if(e&&e.length){for(var a=function(n){t.forEach((function(t){t.staff_no===e[n].id&&r.push(t.staff_no)}))},c=0;c<e.length;c+=1)a(c);if(r.length===e.length)return I.push(n),!0}return!1}(t[a].children,n,t[a].id),c.is_department=t[a].is_department,n.forEach((function(e){e.staff_no===t[a].id&&(c.disabled=!0)})),t[a].children&&t[a].children.length&&(c.children=e(t[a].children,n)),r.push(c)},c=0;c<t.length;c+=1)a(c);return r};B();var K=Object(r.reactive)({product_id:null===(t=Object(g.G)("productInfo",!0))||void 0===t?void 0:t.id,staff_nos:[]}),z=function(){var e=Object(p.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K.product_id=null===(t=Object(g.G)("productInfo",!0))||void 0===t?void 0:t.id,K.staff_nos=[],!G.value||!G.value.length){e.next=8;break}return G.value.forEach((function(e){K.staff_nos.push(e.staff_no)})),e.next=6,n=K,void Object(j.d)(n).then(function(){var e=Object(p.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.code){e.next=10;break}return i(t.code),S.value=!1,D.value=[],e.next=6,y(f.value.getCurrentPage());case 6:return e.next=8,B();case 8:e.next=11;break;case 10:i(t.code,t.message);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:e.next=9;break;case 8:S.value=!1;case 9:case"end":return e.stop()}var n}),e)})));return function(){return e.apply(this,arguments)}}(),J=Object(r.ref)([]);return Object(b.a)(Object(b.a)({setAsOwner:function(e){C.a.confirm("项目负责人有且仅有一个，是否确认变更？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(t){"confirm"===t&&Object(j.ab)({product_id:e.product_id,staff_no:e.staff_no}).then(function(){var e=Object(p.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.code){e.next=4;break}return i(t.code),e.next=4,y(f.value.getCurrentPage());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))},tipMessage:i,handleAdd:function(){S.value=!0,G.value=[],D.value=s.value},handleConditionSearch:N,stopAutoGetData:m,getData:y},Object(r.toRefs)(d)),{},{pageTableRef:f,searchParams:l,keywordTreeRef:P,handleDelete:function(e,t){C.a.confirm("此操作将永久删除该成员，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n,a=Object(r.reactive)({product_id:null===(n=Object(g.G)("productInfo",!0))||void 0===n?void 0:n.id,staff_nos:[e.staff_no]});Object(j.i)(a).then(function(){var n=Object(p.a)(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t(r.code),200!==r.code){n.next=13;break}if(Object(g.G)("user",!0).staff_no!==e.staff_no){n.next=9;break}Object(g.A)("productId"),u.push({name:"iteration",query:{come:"member",productId:null}}),setTimeout((function(){window.location.reload()}),100),n.next=13;break;case 9:return n.next=11,y(f.value.getCurrentPage());case 11:return n.next=13,B();case 13:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))},handleName:function(e){o.value=!0,e||N()},handleShadow:z,selectPerson:G,deleteCheckedKeys:function(e,t){G.value.splice(t,1),Object(r.nextTick)((function(){null==P||P.value.setCheckedKeys(G.value.map((function(e){return e.staff_no}))),null==P||P.value.setCheckedKeys(I.forEach((function(e){return e})))}))},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleCheckBoxEventByText:function(e,t){var n=Object(r.ref)([]);G.value.forEach((function(e){n.value.push(e.staff_no)})),n.value.includes(e.id)?G.value.forEach((function(t,n){t.staff_no===e.id&&G.value.splice(n,1)})):(J.value=JSON.parse(JSON.stringify(G.value)),t.checkedNodes.length?(G.value=[],t.checkedNodes.forEach((function(e){e.is_department||e.disabled||G.value.push({staff_name:e.label,staff_no:e.id,is_department:e.is_department})}))):G.value=[])},checkedKeys:V,dialogShadow:S,allPeople:D,filterText:E,page:c})}}),V=(n("11468"),n("ca1b"),n("6b0d"));const R=n.n(V)()(N,[["render",function(e,t,n,b,p,O){var h=Object(r.resolveComponent)("el-input"),j=Object(r.resolveComponent)("el-form-item"),v=Object(r.resolveComponent)("el-button"),m=Object(r.resolveComponent)("el-form"),g=Object(r.resolveComponent)("el-table-column"),x=Object(r.resolveComponent)("page-table"),w=Object(r.resolveComponent)("el-tree"),k=Object(r.resolveComponent)("el-scrollbar"),_=Object(r.resolveComponent)("el-divider"),C=Object(r.resolveComponent)("Close"),y=Object(r.resolveComponent)("el-icon"),N=Object(r.resolveComponent)("el-dialog");return Object(r.openBlock)(),Object(r.createElementBlock)("div",a,[Object(r.createVNode)(x,{tableData:e.list,currentPage:e.page,onHandlePagationChange:e.getData,total:e.total,ref:"pageTableRef",stopAutoGetData:e.stopAutoGetData},{header:Object(r.withCtx)((function(){return[Object(r.createVNode)(m,{inline:!0,model:e.searchParams,onSubmit:t[2]||(t[2]=Object(r.withModifiers)((function(){}),["prevent"]))},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(j,{label:""},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(h,{modelValue:e.searchParams.keyword,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.searchParams.keyword=t}),modelModifiers:{trim:!0},onChange:e.handleName,onKeyup:Object(r.withKeys)(e.handleConditionSearch,["enter"]),placeholder:"姓名、岗位、部门搜索",clearable:""},null,8,["modelValue","onChange","onKeyup"])]})),_:1}),Object(r.createVNode)(j,{style:{float:"right"}},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(v,{type:"primary",onClick:t[1]||(t[1]=function(t){return e.handleAdd()})},{default:Object(r.withCtx)((function(){return[c]})),_:1})]})),_:1})]})),_:1},8,["model"])]})),main:Object(r.withCtx)((function(){return[Object(r.createVNode)(g,{label:"员工编号",width:"140"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",null,Object(r.toDisplayString)(e.row.shr_staff_no||e.row.staff_no),1)]})),_:1}),Object(r.createVNode)(g,{prop:"staff_name",width:"180",label:"姓名"}),Object(r.createVNode)(g,{prop:"role",width:"180",label:"角色"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",null,Object(r.toDisplayString)(2===e.row.role?"项目负责人":"项目成员"),1)]})),_:1}),Object(r.createVNode)(g,{prop:"job_name",label:"岗位"}),Object(r.createVNode)(g,{prop:"job_path",label:"部门"}),Object(r.createVNode)(g,{label:"操作",width:"180",align:"center"},{default:Object(r.withCtx)((function(t){return[e.can_opt_manager?(Object(r.openBlock)(),Object(r.createBlock)(v,{key:0,disabled:2===t.row.role,type:"text",onClick:function(n){return e.setAsOwner(t.row)}},{default:Object(r.withCtx)((function(){return[o]})),_:2},1032,["disabled","onClick"])):Object(r.createCommentVNode)("",!0),Object(r.createVNode)(v,{disabled:2===t.row.role,class:Object(r.normalizeClass)([2===t.row.role?"":"delete"]),type:"text",onClick:function(n){return e.handleDelete(t.row,e.tipMessage)}},{default:Object(r.withCtx)((function(){return[u]})),_:2},1032,["disabled","class","onClick"])]})),_:1})]})),_:1},8,["tableData","currentPage","onHandlePagationChange","total","stopAutoGetData"]),Object(r.createVNode)(N,{title:"添加成员","custom-class":"position-dialog",modelValue:e.dialogShadow,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.dialogShadow=t}),"append-to-body":!0,width:"42%"},{footer:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("span",s,[Object(r.createVNode)(v,{type:"primary",disabled:!e.dialogShadow,onClick:e.handleShadow},{default:Object(r.withCtx)((function(){return[f]})),_:1},8,["disabled","onClick"])])]})),default:Object(r.withCtx)((function(){return[e.allPeople?(Object(r.openBlock)(),Object(r.createElementBlock)("div",d,[Object(r.createVNode)(h,{placeholder:"输入姓名查找",modelValue:e.filterText,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.filterText=t})},null,8,["modelValue"]),Object(r.createVNode)(k,{height:"400px"},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(w,{onCheck:e.handleCheckBoxEventByText,"node-key":"id","default-expand-all":"","show-checkbox":"","check-strictly":!1,data:e.allPeople,"default-checked-keys":e.checkedKeys,"filter-node-method":e.filterNode,ref:"keywordTreeRef"},null,8,["onCheck","data","default-checked-keys","filter-node-method"])]})),_:1})])):(Object(r.openBlock)(),Object(r.createElementBlock)("div",i,l)),Object(r.createElementVNode)("div",null,[Object(r.createVNode)(_,{direction:"vertical"})]),Object(r.createElementVNode)("div",null,[Object(r.createVNode)(k,{height:"400px"},{default:Object(r.withCtx)((function(){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(e.selectPerson,(function(t,n){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{key:n,class:"current-checked-nodes"},[Object(r.createVNode)(v,{icon:"el-icon-user-solid",type:"text"},{default:Object(r.withCtx)((function(){return[Object(r.createTextVNode)(Object(r.toDisplayString)(t.staff_name),1)]})),_:2},1024),Object(r.createVNode)(y,{style:{"margin-right":"10px","margin-top":"10px"},class:"el-icon-close",onClick:function(r){return e.deleteCheckedKeys(t,n)}},{default:Object(r.withCtx)((function(){return[Object(r.createVNode)(C)]})),_:2},1032,["onClick"])])})),128))]})),_:1})])]})),_:1},8,["modelValue"])])}],["__scopeId","data-v-31cf93e0"]]);t.default=R},f884:function(e,t,n){}}]);