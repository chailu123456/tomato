(window.webpackJsonp=window.webpackJsonp||[]).push([["demandPool"],{"3e3f":function(e,t,a){},"48ce":function(e,t,a){},8716:function(e,t,a){"use strict";a("3e3f")},b50e:function(e,t,a){},e1f2:function(e,t,a){"use strict";a("48ce")},e406:function(e,t,a){"use strict";a("b50e")},face:function(e,t,a){"use strict";a.r(t),a("b0c0"),a("caad"),a("a4d3"),a("e01a");var n=a("7a23"),r=function(e){return Object(n.pushScopeId)("data-v-61fe755f"),e=e(),Object(n.popScopeId)(),e},o={class:"index demandPool",style:{height:"calc(100% + 10px)"}},l={class:"search-header"},c={class:"search-right"},i=Object(n.createTextVNode)("导 出"),u=Object(n.createTextVNode)("审批单"),d=Object(n.createTextVNode)("新 增"),s=["onClick"],m={key:0,style:{"margin-left":"-20%"}},f={key:1,style:{"margin-left":"-20%"}},b={key:0,class:"rp-demand-list"},p={class:"demand-list-show",ref:"columnsWrapperRef"},v={class:"demand-detail-show",style:{overflow:"auto"}},O=["onClick"],h={key:0,class:"content-msg"},j={key:1,class:"content-origin"},_={key:2},g=["onClick"],k={class:"content-give"},y={key:3},C=["onClick"],w={class:"content-cycle"},V={class:"block-loadingMore"},N={key:1,class:"index-popup"},x=Object(n.createTextVNode)(" 基础项 "),F=Object(n.createTextVNode)(" 创建计划 "),S=r((function(){return Object(n.createElementVNode)("i",{class:"el-icon--right"},null,-1)})),D=Object(n.createTextVNode)(" 申请审批 "),B=r((function(){return Object(n.createElementVNode)("i",{class:"el-icon--right"},null,-1)})),E=Object(n.createTextVNode)(" 删除 "),T=r((function(){return Object(n.createElementVNode)("i",{class:"el-icon--right"},null,-1)})),I={style:{"margin-bottom":"160px"}},P={class:"dialog-footer"},L=Object(n.createTextVNode)("取 消"),M=Object(n.createTextVNode)("确 定"),R=a("5530"),U=a("1da1"),z=(a("96cf"),a("a9e3"),a("d81d"),a("159b"),a("d3b7"),a("4de4"),a("ac1f"),a("5319"),a("c740"),a("25f0"),a("a15b"),a("38d1"));function A(){return J.apply(this,arguments)}function J(){return(J=Object(U.a)(regeneratorRuntime.mark((function e(){var t,a,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:1,a=r.length>1&&void 0!==r[1]?r[1]:20,20!==(n=r.length>2?r[2]:void 0).page_size&&(a=100),e.next=6,Object(z.D)(Object(R.a)(Object(R.a)({},n),{},{pageIndex:t,pageSize:a}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a("7db0"),a("fb6a"),a("2532"),a("a434");var q=a("23c4"),Y=a("0613"),H=a("d257"),K=a("eaf6"),G=a("b23d"),Q=a("f6f2"),$=a("3532"),W=a("5a0c"),X=a.n(W),Z=a("2ef0"),ee=a("8fa4f"),te=a("b3ae"),ae=a("867b"),ne={class:"rp-form-content"},re={key:0,style:{"margin-left":"10px",color:"#606266"}},oe={key:1,style:{"margin-left":"10px",color:"#606266"}},le={key:2},ce={style:{display:"flex","align-items":"center","margin-left":"10px"}},ie={class:"default-form-item"},ue={class:"default-form-item",style:{width:"100%",height:"30px"}},de={class:"default-form-item"},se={class:"default-form-item"},me={class:"default-form-item"},fe={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},be=Object(n.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1),pe={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},ve=Object(n.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1),Oe={class:"file-list"},he=Object(n.createElementVNode)("div",{class:"file-title"},"附件",-1),je={class:"upload-icon"},_e={class:"list-detail"},ge=["onClick"],ke={class:"detail-right"},ye=Object(n.defineComponent)({props:{iterationList:{type:Array,default:function(){return[]}},demandForm:{type:Object,default:function(){}}},emits:["onChangeTask"],setup:function(e,t){var a,r=t.emit,o=e,l=Object(Y.c)(),c=Object(K.a)().tipMessage,i=Object(H.G)("user",!0),u=Object(n.ref)({}),d=Object(n.computed)((function(){var e;return null==l||null===(e=l.getters)||void 0===e?void 0:e.productInfo})),s=Object(n.ref)(o.iterationList),m=function(e){Object(ae.a)()(e).then((function(e){e&&e.length?s.value=e:s.value=[]}))},f=Object(n.ref)(),b=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t){var a,n,r,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(o.demandForm.product_module_id===t&&(o.demandForm.product_module_id=0),l={id:[o.demandForm.id],product_module_id:0,product_module_name:(null===(r=f.value[0])||void 0===r?void 0:r.name)||"",field:"product_module_id"},o.demandForm.id&&N(l)),e.next=3,Object(te.a)({id:null===(a=d.value)||void 0===a?void 0:a.id,name:null===(n=d.value)||void 0===n?void 0:n.name});case 3:null!=(c=e.sent)&&c.length&&(f.value=c,f.value.unshift({value:-1,label:"管理模块",level:-1,id:-1,name:"管理模块"}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=Object(n.ref)([]),v=function(){var e;null!==(e=d.value)&&void 0!==e&&e.id&&Object(z.e)({product_id:d.value.id}).then((function(e){e.data&&e.data.length?p.value=e.data:p.value=[]}))},O=function(e){!s.value.length&&e&&m(o.demandForm.product_id)},h=function(e){if(o.demandForm.product_module_id=e.value,o.demandForm.product_module_name=e.label,o.demandForm.id){var t={id:[o.demandForm.id],product_module_id:e.value,product_module_name:e.label,field:"product_module_id"};N(t)}},j=Object(n.computed)((function(){return l.getters.productList})),_=Object(n.ref)(!1),g=function(){_.value=!0},k=Object(n.computed)((function(){return o.demandForm.attachment})),y=function(e,t,a){if(_.value=!1,e.url){var n=a.slice().map((function(e){return{title:e.name,addr:e.response?e.response.url:e.url,size:e.response?e.response.size:e.size,file_type:e.response?e.response.file_type:"",creator:null==i?void 0:i.name,create_time:X()().format("YYYY-MM-DD HH:mm:ss")}}));if(k.value.unshift(n[n.length-1]),o.demandForm.attachment=k.value,!o.demandForm.id)return;var r={id:[o.demandForm.id],attachment:k.value,field:"attachment"};N(r)}},C=o.demandForm.hours||0,w=0;w=(null===(a=o.demandForm)||void 0===a?void 0:a.actual_hours)||0,Object(n.watch)((function(){return o.demandForm}),(function(e){e.product_id&&m(e.product_id),u.value=JSON.parse(JSON.stringify(o.demandForm)),v(),b(),C=o.demandForm.hours||0,w=o.demandForm.actual_hours?o.demandForm.actual_hours:0}),{deep:!0,immediate:!0});var V=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t,a){var n,r,l,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("product_id"!==a){e.next=7;break}return o.demandForm.iteration_id=null,o.demandForm.product_module_id=0,o.demandForm.product_module_name="主干",e.next=7,m(t);case 7:if(n={id:[o.demandForm.id]},"hours"!==a&&"actual_hours"!==a){e.next=36;break}if(""!==t){e.next=13;break}return"hours"===a&&(o.demandForm.hours=C),"actual_hours"===a&&(o.demandForm.actual_hours=w),e.abrupt("return",c(400,"请输入大于0的正整数"));case 13:if(!Object(Z.isNumber)(1*t)){e.next=35;break}if(!(Number(t)<0)){e.next=18;break}return"hours"===a&&(o.demandForm.hours=C),"actual_hours"===a&&(o.demandForm.actual_hours=w),e.abrupt("return",c(400,"请输入大于0的正整数"));case 18:if(r=/^\+?[0-9][0-9]*$/,"hours"!==a){e.next=26;break}if(r.test(o.demandForm.hours)){e.next=23;break}return o.demandForm.hours=C,e.abrupt("return",c(400,"请输入大于0的正整数"));case 23:if(!(Number(t)>1e3)){e.next=26;break}return o.demandForm.hours=C,e.abrupt("return",c(400,"请输入0-1000之间的正整数"));case 26:if("actual_hours"!==a){e.next=33;break}if(r.test(o.demandForm.actual_hours)){e.next=30;break}return o.demandForm.actual_hours=w,e.abrupt("return",c(400,"请输入大于0的正整数"));case 30:if(!(Number(t)>1e3)){e.next=33;break}return o.demandForm.actual_hours=w,e.abrupt("return",c(400,"请输入0-1000之间的正整数"));case 33:e.next=36;break;case 35:return e.abrupt("return",c(400,"请输入大于0的正整数"));case 36:if(!o.demandForm.name){e.next=39;break}if(!(o.demandForm.name.length<3||o.demandForm.name.length>100)){e.next=39;break}return e.abrupt("return",c(400,"请输入长度在 4 到 100 个字符"));case 39:if("staff_no"===a&&p.value&&(l=p.value[1],i=l.options.filter((function(e){return e.staff_no===t})),n.staff_name=i[0].staff_name,o.demandForm.staff_name=i[0].staff_name,o.demandForm.staff_no=i[0].staff_no),"iteration_id"===a&&(t||(t=0)),n[a]=t,["demand_status","level","hours","actual_hours"].includes(a)&&(n[a]=1*t),"hours"!==a&&"actual_hours"!==a||(o.demandForm[a]=n[a]),"start_time"!==a&&"end_time"!==a){e.next=52;break}if(!o.demandForm.start_time||!o.demandForm.end_time){e.next=52;break}if(!(o.demandForm.start_time>o.demandForm.end_time)){e.next=52;break}return c(400,"计划开始时间不能大于结束时间"),o.demandForm.start_time=u.value.start_time,o.demandForm.end_time=u.value.end_time,e.abrupt("return");case 52:if(o.demandForm.id){e.next=54;break}return e.abrupt("return");case 54:n.field=a,N(n);case 56:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),N=function(e){Object(z.q)(e).then((function(t){if(200===t.code)return r("onChangeTask",o.demandForm.id),setTimeout((function(){v()}),500),e.demand_status&&5==e.demand_status?c(200,"修改成功，请填写消耗工时，以便记录工作情况"):c(200,"成功")}))},x=function(e){if(o.demandForm.origin=e,o.demandForm.id){var t={id:[o.demandForm.id],origin:e,field:"origin"};N(t)}};return Object(n.onMounted)((function(){})),function(t,a){var r=Object(n.resolveComponent)("el-option"),l=Object(n.resolveComponent)("el-select"),c=Object(n.resolveComponent)("el-form-item"),i=Object(n.resolveComponent)("el-option-group"),u=Object(n.resolveComponent)("module-select"),d=Object(n.resolveComponent)("el-date-picker"),m=Object(n.resolveComponent)("el-input"),v=Object(n.resolveComponent)("el-form"),C=Object(n.resolveComponent)("el-icon"),w=Object(n.resolveComponent)("el-upload"),F=Object(n.resolveDirective)("loading");return Object(n.openBlock)(),Object(n.createElementBlock)("div",ne,[Object(n.createVNode)(v,{model:e.demandForm,ref:"ruleFormRef","label-position":"left","label-width":"100px"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(c,{label:"需求类型",prop:"type"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(l,{teleported:!1,class:"reset-select",onChange:a[0]||(a[0]=function(e){return V(e,"type")}),filterable:"",modelValue:e.demandForm.type,"onUpdate:modelValue":a[1]||(a[1]=function(t){return e.demandForm.type=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(Object(n.unref)(q.B),(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.value,label:e.value,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(n.createVNode)(c,{label:"状态"},{default:Object(n.withCtx)((function(){return[1==e.demandForm.demand_status?(Object(n.openBlock)(),Object(n.createElementBlock)("span",re,"待审核")):3==e.demandForm.demand_status?(Object(n.openBlock)(),Object(n.createElementBlock)("span",oe,"审批中")):(Object(n.openBlock)(),Object(n.createElementBlock)("div",le,[Object(n.createVNode)(l,{teleported:!1,disabled:!e.demandForm.id,class:"reset-select",onChange:a[2]||(a[2]=function(e){return V(e,"demand_status")}),filterable:"",modelValue:e.demandForm.demand_status,"onUpdate:modelValue":a[3]||(a[3]=function(t){return e.demandForm.demand_status=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(Object(n.unref)(q.g),(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.value,label:e.label,disabled:e.disabled,value:e.value},null,8,["label","disabled","value"])})),128))]})),_:1},8,["disabled","modelValue"])]))]})),_:1}),Object(n.createVNode)(c,{label:"指派给",prop:"name"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(l,{teleported:!1,class:"reset-select",onChange:a[4]||(a[4]=function(e){return V(e,"staff_no")}),filterable:"",modelValue:e.demandForm.staff_name,"onUpdate:modelValue":a[5]||(a[5]=function(t){return e.demandForm.staff_name=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(p.value,(function(e){return Object(n.openBlock)(),Object(n.createBlock)(i,{key:e.staff_no,label:e.label},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(e.options,(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.staff_no,label:e.staff_name,value:e.staff_no},null,8,["label","value"])})),128))]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(n.createVNode)(c,{label:"优先级",prop:"level"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",ce,[Object(n.createElementVNode)("div",{style:Object(n.normalizeStyle)({width:"8px",height:"8px",marginRight:"4px",display:"inline-block",borderRadius:"50%",background:(t=e.demandForm.level,o=q.f.find((function(e){return e.value==t})),null==o?void 0:o.color)})},null,4),Object(n.createVNode)(l,{teleported:!1,onChange:a[6]||(a[6]=function(e){return V(e,"level")}),class:"reset-select",style:{display:"flex",flex:1},filterable:"",modelValue:e.demandForm.level,"onUpdate:modelValue":a[7]||(a[7]=function(t){return e.demandForm.level=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(Object(n.unref)(q.f),(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])];var t,o})),_:1}),Object(n.createVNode)(c,{label:"归属项目",prop:"name"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(l,{teleported:!1,onChange:a[8]||(a[8]=function(e){return V(e,"product_id")}),class:"reset-select",filterable:"",modelValue:e.demandForm.product_id,"onUpdate:modelValue":a[9]||(a[9]=function(t){return e.demandForm.product_id=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(Object(n.unref)(j),(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(n.createVNode)(c,{label:"所属模块"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",ie,[Object(n.createVNode)(u,{value:e.demandForm.product_module_id,"onUpdate:value":a[10]||(a[10]=function(t){return e.demandForm.product_module_id=t}),list:f.value,onUpdateUseCase:b,onChange:h},null,8,["value","list"])])]})),_:1}),Object(n.createVNode)(c,{label:"迭代"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(l,{teleported:!1,onChange:a[11]||(a[11]=function(e){return V(e,"iteration_id")}),class:"reset-select",filterable:"",clearable:"",onVisibleChange:O,modelValue:e.demandForm.iteration_id,"onUpdate:modelValue":a[12]||(a[12]=function(t){return e.demandForm.iteration_id=t}),placeholder:"请选择"},{default:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(s.value,(function(e){return Object(n.openBlock)(),Object(n.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(n.createVNode)(c,{label:"来源人"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",ue,[Object(n.createVNode)(ee.a,{onUpdateOrigin:x,val:e.demandForm.origin_staff},null,8,["val"])])]})),_:1}),Object(n.createVNode)(c,{label:"收集时间"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",de,[Object(n.createVNode)(d,{"value-format":"YYYY-MM-DD",onChange:a[13]||(a[13]=function(e){return V(e,"collect_time")}),modelValue:e.demandForm.collect_time,"onUpdate:modelValue":a[14]||(a[14]=function(t){return e.demandForm.collect_time=t}),type:"date",size:"default",placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(n.createVNode)(c,{label:"计划开始时间"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",se,[Object(n.createVNode)(d,{"value-format":"YYYY-MM-DD",onChange:a[15]||(a[15]=function(e){return V(e,"start_time")}),modelValue:e.demandForm.start_time,"onUpdate:modelValue":a[16]||(a[16]=function(t){return e.demandForm.start_time=t}),type:"date",size:"default",placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(n.createVNode)(c,{label:"计划完成时间"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",me,[Object(n.createVNode)(d,{"value-format":"YYYY-MM-DD",onChange:a[17]||(a[17]=function(e){return V(e,"end_time")}),modelValue:e.demandForm.end_time,"onUpdate:modelValue":a[18]||(a[18]=function(t){return e.demandForm.end_time=t}),type:"date",placeholder:"请选择日期",size:"default",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(n.createVNode)(c,{label:"预计工时"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",fe,[Object(n.createVNode)(m,{type:"number",onChange:a[19]||(a[19]=function(e){return V(e,"hours")}),modelValue:e.demandForm.hours,"onUpdate:modelValue":a[20]||(a[20]=function(t){return e.demandForm.hours=t})},null,8,["modelValue"]),be])]})),_:1}),e.demandForm.id?(Object(n.openBlock)(),Object(n.createBlock)(c,{key:0,label:"实际工时"},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",pe,[Object(n.createVNode)(m,{type:"number",onChange:a[21]||(a[21]=function(e){return V(e,"actual_hours")}),modelValue:e.demandForm.actual_hours,"onUpdate:modelValue":a[22]||(a[22]=function(t){return e.demandForm.actual_hours=t})},null,8,["modelValue"]),ve])]})),_:1})):Object(n.createCommentVNode)("",!0)]})),_:1},8,["model"]),Object(n.createElementVNode)("div",Oe,[he,Object(n.createElementVNode)("div",null,[Object(n.withDirectives)((Object(n.openBlock)(),Object(n.createBlock)(w,{"show-file-list":!1,"before-upload":g,"on-success":y,action:Object(n.unref)(G.a).uploadAssets,multiple:!1},{default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("span",je,[Object(n.createVNode)(C,null,{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(Object(n.unref)(Q.Plus))]})),_:1})])]})),_:1},8,["action"])),[[F,_.value]]),Object(n.createElementVNode)("ul",_e,[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(Object(n.unref)(k),(function(e,t){return Object(n.openBlock)(),Object(n.createElementBlock)("li",{key:e.addr,onClick:function(t){return a=e,void Object($.a)(a.title,a.addr);var a}},[Object(n.createVNode)(C,{class:"list-detail-icon"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(Object(n.unref)(Q.Document))]})),_:1}),Object(n.createElementVNode)("div",ke,[Object(n.createVNode)(C,{class:"icon-remove",onClick:Object(n.withModifiers)((function(e){return function(e){k.value.splice(e,1);var t={id:[o.demandForm.id],attachment:k.value,field:"attachment"};o.demandForm.id&&N(t)}(t)}),["stop"])},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(Object(n.unref)(Q.Close))]})),_:2},1032,["onClick"]),Object(n.createElementVNode)("p",null,Object(n.toDisplayString)(e.title),1),Object(n.createElementVNode)("p",null,Object(n.toDisplayString)(e.creator)+" "+Object(n.toDisplayString)(e.create_time),1)])],8,ge)})),128))])])])])}}});a("e1f2"),a("8716");var Ce=ye,we=a("6c02"),Ve=a("7b31"),Ne=a("6b59"),xe=a("2d40"),Fe=Object(n.defineComponent)({name:"Sort"});const Se={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},De=Object(n.createVNode)("path",{fill:"currentColor",d:"M384 96a32 32 0 0 1 64 0v786.752a32 32 0 0 1-54.592 22.656L95.936 608a32 32 0 0 1 0-45.312h.128a32 32 0 0 1 45.184 0L384 805.632V96zm192 45.248a32 32 0 0 1 54.592-22.592L928.064 416a32 32 0 0 1 0 45.312h-.128a32 32 0 0 1-45.184 0L640 218.496V928a32 32 0 1 1-64 0V141.248z"},null,-1);Fe.render=function(e,t,a,r,o,l){return Object(n.openBlock)(),Object(n.createBlock)("svg",Se,[De])},Fe.__file="packages/components/Sort.vue";var Be=Fe,Ee=a("7f6ba"),Te=a("0472"),Ie=a("9db4"),Pe=a("9b06"),Le=a("c252"),Me=a("3a3a"),Re=a("6669"),Ue=a("5d09"),ze=a("3740"),Ae=Object(n.defineComponent)({name:"demandPool",components:{Sort:Be,Drawer:Te.a,FormDemand:Ce,InputOption:Ie.a,ArrowUp:Ee.a,dialogDemand:Ue.a,selectOption:Pe.a},props:{comePlan:{type:String,default:function(){return""}},id:{type:Number,default:function(){return 0}}},setup:function(e){var t,a,r,o,l=Object(K.a)().tipMessage,c=Object(n.ref)(Object(H.G)("productInfo",!0)),i=Object(H.G)("user",!0),u=Object(we.f)(),d=Object(we.e)(),s=Object(n.ref)("新增需求"),m=Object(n.ref)(),f=Object(n.ref)(),b=Object(n.ref)(!1),p=Object(n.ref)({staff_name:"",staff_no:""}),v=Object(n.ref)("-1"),O=Object(n.ref)(!1),h=Object(n.ref)(!1),j=Object(n.ref)(),_=Object(n.ref)(!1),g=Object(n.ref)(""),k=Object(n.ref)({demand_status:[],product_id:[],plan_id:[],staff_no:[],iteration_id:null,product_module_id:[-1],level:[],name:"",create_by:[],type:"",sort_name:"",sort_by:0,page_size:20,page_index:1}),y={demand_status:[],product_id:[],plan_id:[],product_module_id:[-1],staff_no:[],iteration_id:null,level:[],name:"",create_by:[],type:"",sort_name:"",sort_by:0,page_size:20,page_index:1},C=Object(n.reactive)({total:0,list:[]}),w=Object(n.ref)({}),V={attachment:[],collect_time:X()().format("YYYY-MM-DD"),create_by:"",create_time:"",creator:"",delete_time:"",demand_status:1===(null===(t=c.value)||void 0===t?void 0:t.is_approval)?1:2,description:"",end_time:"",hours:0,iteration_id:null,iteration_name:"",level:"3",type:1,name:"",origin:null==i?void 0:i.staff_no,origin_remark:"",origin_staff:null==i?void 0:i.name,product_id:null===(a=c.value)||void 0===a?void 0:a.id,product_module_id:0,product_module_name:null===(r=c.value)||void 0===r?void 0:r.name,product_name:null===(o=c.value)||void 0===o?void 0:o.name,staff_name:null==i?void 0:i.name,staff_no:null==i?void 0:i.staff_no,start_time:"",status_list:[]},N=Object(n.ref)("view"),x=Object(n.ref)("view"),F=Object(n.ref)(!1),S=Object(n.ref)(1),D=Object(n.ref)(1),B=Object(n.ref)(!1),E=Object(n.ref)(!1),T=Object(n.ref)(!0),I=Object(n.ref)(""),P=Object(n.ref)(),L=Object(n.reactive)([{titleColor:"rgb(219 219 219)",titleName:"未开始",status:2,listData:[],isDisable:!1,isShowLoadingMore:!1,hasData:!0,page_index:1,page_size:10},{titleColor:"rgba(250, 252, 239, 1)",titleName:"设计中",status:4,listData:[],isDisable:!1,isShowLoadingMore:!1,hasData:!0,page_index:1,page_size:10},{titleColor:"rgba(250, 252, 239, 1)",titleName:"设计完成",status:5,listData:[],isDisable:!1,isShowLoadingMore:!1,hasData:!0,page_index:1,page_size:10},{titleColor:"rgba(250, 252, 239, 1)",titleName:"已评审",status:6,listData:[],isDisable:!1,isShowLoadingMore:!1,hasData:!0,page_index:1,page_size:10},{titleColor:"rgba(225, 239, 251, 1)",titleName:"开发中",status:7,listData:[],isDisable:!0,isShowLoadingMore:!1,hasData:!0,page_index:1,page_size:10}]),M=Object(n.ref)(1);Object(n.onDeactivated)((function(){F.value=!1}));var J=Object(n.ref)([]),G=Object(n.ref)([]),Q=function(e){e&&Object(z.e)({product_id:e}).then((function(e){e.data&&e.data.length?(J.value=e.data,G.value=e.data[1].options.map((function(e){return{value:e.staff_no,label:e.staff_name}}))):(J.value=[],G.value=[])}))},$=Object(n.ref)([]),W=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(n.computed)((function(){return Y.b.getters.productList})),a=JSON.parse(JSON.stringify(t.value))){e.next=4;break}return e.abrupt("return");case 4:$.value=a.map((function(e){return Object(R.a)(Object(R.a)({},e),{},{value:e.id,label:e.name})}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=Object(n.ref)([]),ee=Object(n.ref)([]),ne=Object(n.ref)([]),re=Object(n.ref)([]),oe=function(e){Object(z.E)(e).then((function(e){e.data&&e.data.length?re.value=e.data:re.value=[]}))},le=function(e){Object(z.G)(e||k.value).then((function(e){if(200===e.code){var t=e.data;ce(t)}}))},ce=function(e){L.forEach((function(t){t.listData=[],null==e||e.forEach((function(e){t.status===e.status&&t.listData.push(e)})),t.isShowLoadingMore=t.listData.length>9,t.hasData=!0,t.page_index=1,t.page_size=10}))};Object(n.watch)((function(){return T.value}),(function(e){e||le()})),Object(n.watch)((function(){return F.value}),(function(e){e||(_e(I.value.getCurrentPage(),void 0,k.value),Object(H.K)(),setTimeout((function(){Q(k.value.product_id)}),500))}));var ie={product_module_id:0},ue=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ie={id:Se(),field:"product_module_id",product_module_id:t.id};case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=Object(n.ref)(),se=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t,a){var n,r,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&ie.product_module_id===t&&(ie.product_module_id=0,de.value&&de.value[0].name&&(ie.product_module_name=(null===(o=de.value[0])||void 0===o?void 0:o.name)||""),j.value=a||0),e.next=3,Object(te.a)({id:null===(n=c.value)||void 0===n?void 0:n.id,name:null===(r=c.value)||void 0===r?void 0:r.name});case 3:null!=(l=e.sent)&&l.length&&(de.value=l,de.value.unshift({value:-1,label:"管理模块",level:-1,id:-1,name:"管理模块"}));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),me=function(t){e.comePlan?u.push({name:"demandPool",query:{where:"planDetail",demandName:t.name}}):(s.value="查看详情",N.value="view",x.value="view",F.value=!0,h.value=!0,fe(t.id),oe(t.id),Object(H.u)(t.id))},fe=function(e){e&&Object(z.z)({id:e}).then((function(e){w.value=e.data,w.value.level=w.value.level+"",w.value.iteration_id=w.value.iteration_id?w.value.iteration_id:null})).finally((function(){h.value=!1}))},be=function(){var e,t,a;s.value="新增需求",N.value="add",x.value="add",c.value=Object(H.G)("productInfo",!0),V.demand_status=1===(null===(e=c.value)||void 0===e?void 0:e.is_approval)?1:2,V.product_id=null===(t=c.value)||void 0===t?void 0:t.id,V.product_name=null===(a=c.value)||void 0===a?void 0:a.name,w.value=JSON.parse(JSON.stringify(V)),re.value=[],F.value=!0},pe=1;Object(n.onMounted)((function(){var e=d.query.detailId;"demandPool"===u.currentRoute.value.name&&e&&me({id:e}),Q(k.value.product_id)})),Object(n.onActivated)((function(){var e=d.query,t=e.productId,a=e.auto,n=e.ids,r=e.name;a&&(k.value=JSON.parse(JSON.stringify(y)),k.value.product_id=t,k.value.name=r,Be.searchForm[0].val=r,v.value="-10",me({id:n}),setTimeout((function(){u.replace({path:d.path,query:{productId:t,name:void 0,auto:void 0}})}),1e3))}));var ve,Oe=function(e){if(e.hasData){var t=e.status,a={demand_status:e.status};(a=Object.assign({},a,k.value)).page_index=e.page_index+1,a.page_size=e.page_size,a.demand_status=e.status,Object(z.F)(a).then((function(a){if(0===a.data.length)e.isShowLoadingMore=!1,e.hasData=!1;else{e.page_index=e.page_index+1;var n=L.findIndex((function(e){return e.status===t}));a.data.length<10&&(L[n].hasData=!1,L[n].isShowLoadingMore=!1),a.data.forEach((function(e){L[n].listData.push(e)}))}}))}},he=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=JSON.parse(JSON.stringify(k.value))).type||delete t.type,C.total){e.next=4;break}return e.abrupt("return",l(400,"暂无数据，无法导出"));case 4:Object(H.L)(t,"/api/tomato/demand/export");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(e,t){if("add"===t){var a=ze.a.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});Object(z.f)(e).then((function(){return ge(),F.value=!1,a.close(),l(200,"成功")}))}else Object(z.q)(e).then((function(){return oe(e.id[0]),l(200,"成功")}))},_e=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t,a,n){var r,o,l,c,i,u,d,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B.value=null!=a,D.value=t&&t.pageIndex||1,r=Object(Me.a)(A,n||k.value),o=r.response,l=Object(Le.a)(o),c=l.pagation,e.next=6,c(t);case 6:i=e.sent,u=i.data,d=u.list,s=u.count,C.total=s,C.list=d;case 12:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),ge=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==t){e.next=2;break}return e.abrupt("return");case 2:clearTimeout(ve),ve=setTimeout(Object(U.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E.value){e.next=8;break}return I.value.setCurrentPage(),D.value=1,e.next=5,_e({pageIndex:1,pageSize:20},!0,k.value);case 5:E.value=!1,e.next=10;break;case 8:return e.next=10,_e(I.value.getCurrentPage(),!0,k.value);case 10:B.value=!1,(a={product_id:k.value.product_id})&&Object(z.I)(a).then((function(e){e.data&&e.data.length?Z.value=e.data:Z.value=[]})),t={product_id:k.value.product_id},Object(ae.a)()(t.product_id).then((function(e){e&&e.length?(ee.value=e,ne.value=e.map((function(e){return{value:e.id,label:e.name}}))):(ee.value=[],ne.value=[])})),le();case 14:case"end":return e.stop()}var t,a}),e)}))),300);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=Object(n.ref)();Object(Re.a)(ge,function(){var t=Object(U.a)(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return k.value.product_id=a,c.value=Object(H.G)("productInfo",!0),e.comePlan&&(k.value.plan_id=[e.id],k.value.page_size=50),t.next=5,ge();case 5:W();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());var ye=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=I.value)||void 0===t||t.setCurrentPage(),D.value=1,e.next=4,_e(null===(a=I.value)||void 0===a?void 0:a.getCurrentPage(),void 0,Object.assign(k.value));case 4:E.value=!1;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var e=Object(U.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E.value=!0,ge();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fe=function(e){Object(z.q)(e).then((function(t){if(200===t.code)return _e(I.value.getCurrentPage(),void 0,k.value),e.demand_status&&5==e.demand_status?l(200,"修改成功，请填写消耗工时，以便记录工作情况"):(setTimeout((function(){Q(k.value.product_id)}),500),l(200,"成功"))}))},Se=function(){var e,t=[];return null===(e=P.value)||void 0===e||e.forEach((function(e){999!==e.demand_status&&t.push(e.id)})),t},De=Object(n.reactive)([{value:"level",label:"优先级",children:q.f},{value:"demand_status",label:"状态",children:q.g},{value:"staff_no",label:"指派给",children:[]},{value:"type",label:"类型",children:q.B.map((function(e){return{value:e.id,label:e.value}}))},{value:"product_module_id",label:"模块",children:[]},{value:"product_id",label:"项目",children:$},{value:"iteration_id",label:"迭代",children:ne},{value:"origin",label:"来源人"}]),Be=Object(n.reactive)({btnArray:[{id:"-1",label:"所有",key:""},{id:"2,4,5,6,7",label:"未完成",key:"demand_status"},{id:"4",label:"设计中",key:"demand_status"},{id:"5",label:"我创建的",key:"create_by"},{id:"6",label:"指给我的",key:"staff_no"}],searchForm:[{type:"input",label:"需求名称",key:"name",val:""},{type:"customComponents",label:"模块",val:[],key:"product_module_id",componentIndex:2},{type:"select",label:"优先级",multiple:!0,key:"level",val:[],listData:q.f},{type:"select",label:"需求状态",multiple:!0,key:"demand_status",val:[],listData:q.g},{type:"select",label:"创建人",val:[],key:"create_by",showRecord:!0,multiple:!0,valueKey:["staff_no","staff_name"],listData:J},{type:"select",label:"指派给",val:[],key:"staff_no",showRecord:!0,multiple:!0,valueKey:["staff_no","staff_name"],listData:J},{type:"select",label:"所属计划",multiple:!1,val:[],key:"plan_id",valueKey:["id","name"],listData:Z},{type:"select",label:"所属迭代",multiple:!1,val:[],key:"iteration_id",valueKey:["id","name"],listData:ee}]});return Object(n.watch)((function(){return d.query}),(function(e,t){var a=d.query,n=a.productId,r=a.demandId,o=a.id,l=a.type,i=a.where;if("headerDemand"===i&&"add"===l)be(),setTimeout((function(){u.replace({path:d.path,query:{productId:n,type:void 0}})}),700);else if("plan"===i){var s;k.value=JSON.parse(JSON.stringify(y)),k.value.product_id=null===(s=c.value)||void 0===s?void 0:s.id,k.value.plan_id=[o],setTimeout((function(){Be.searchForm[6].val=1*o}),500),e.type&&e.type.length?(k.value.demand_status=e.type,Be.searchForm[3].val=[8]):(k.value.demand_status=[],Be.searchForm[3].val=[]),v.value="-10",Ce(),u.replace({path:d.path,query:{productId:n,type:void 0,id:void 0,where:void 0,demand_status:void 0}})}else if("planDetail"===i){var m;k.value=JSON.parse(JSON.stringify(y)),k.value.product_id=null===(m=c.value)||void 0===m?void 0:m.id,k.value.name=e.demandName,k.value.page_size=100,v.value="-10",Be.searchForm[0].val=e.demandName,Ce(),setTimeout((function(){u.replace({path:d.path,query:{productId:n,demandName:void 0,where:void 0}})}),1e3)}else if("iteration"===i)me({id:r}),setTimeout((function(){u.replace({path:d.path,query:{productId:n,demandId:void 0,where:void 0}})}),1e3);else if("home"===i){var f;k.value=JSON.parse(JSON.stringify(y)),k.value.product_id=null===(f=c.value)||void 0===f?void 0:f.id,k.value.demand_status=[2,4,5,6,7],Be.searchForm[3].val=[2,4,5,6,7],v.value="-10",Ce(),setTimeout((function(){u.replace({path:d.path,query:{productId:n,status:void 0,where:void 0}})}),700)}(null==e?void 0:e.productId)!==(null==t?void 0:t.productId)&&(c.value=Object(H.G)("productInfo",!0))}),{immediate:!0}),Object(R.a)(Object(R.a)({loading:h,sortChange:function(e){var t=e.prop,a=e.order;a&&(k.value.sort_name=t,k.value.sort_by="ascending"===a?1:2,_e(I.value.getCurrentPage(),void 0,k.value))},onChangePriority:function(e,t){Fe({field:"level",id:[t.id],level:e.id})},selectedList:P},Object(n.toRefs)(C)),{},{handleUpdateAssign:function(e,t){if(1===e||2===e){if(1===e&&null!=t&&t.id&&1!==(null==t?void 0:t.demand_status))return Ve.a.warning("非待审核状态无法申请审批");var a,n;if(null!=t&&t.id||null!=t&&t.approval_id)a=1===e?t.id:t.approval_id,n=1===e?t.name:t.approval_title;else{var r,o=null===(r=P.value)||void 0===r?void 0:r.filter((function(e){return 1===e.demand_status}));a=null==o?void 0:o.map((function(e){return e.id})).toString(),n=null==o?void 0:o.map((function(e){return e.name})).toString()}u.push({name:"approval",query:{ids:a,names:n,auto:1,productId:d.query.productId,fromNotices:2===e?"true":"false"}})}else 3===e&&u.push({name:"approval",query:{productId:d.query.productId}})},searchParams:k,getData:_e,PRIORITY:q.p,pageTableRef:I,DEMAND_STATUS:q.g,handleConditionSearch:ge,handleDetail:me,handleAddDemand:be,handleSelectionChange:function(e){P.value=e},userList:J,isShow:T,handleShowPlan:function(e){u.push({name:"planManagement",query:{where:"demand",plan_name:e}})},demandData:L,handleLoadMore:Oe,jupmIteration:function(e){if(e){var t=ee.value.filter((function(t){return t.id===e}));k.value.demand=e,Y.b.commit(xe.a.updateIterateId,e),Y.b.commit(xe.a.updateCurrentIter,t[0]||null),u.push({name:"homepage"})}},handlebatchCancel:function(t){if(e.comePlan)return a={plan_id:1*k.value.plan_id.join(),demand_id:t},void Object(z.X)(a).then((function(){_e(I.value.getCurrentPage(),void 0,k.value)}));var a,n,r=[];t?r.push(t):null===(n=P.value)||void 0===n||n.forEach((function(e){3!==e.demand_status&&r.push(e.id)})),Ne.a.confirm("此操作将永久删除，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"el-button--danger-box",type:"warning"}).then((function(){Object(z.fb)({ids:r}).then((function(){_e(I.value.getCurrentPage(),void 0,k.value)}))}))},requireTypes:q.B,curProductInfo:c,exportTaskDate:he,currentPage:D,searchArray:Be,quickSeacrh:function(e){var t=Object(H.G)("productInfo",!0);if(k.value=JSON.parse(JSON.stringify(y)),k.value.product_id=t.id,e.key){var a={demand_status:["2","4","5","6","7"],create_by:[null==i?void 0:i.staff_no],staff_no:[null==i?void 0:i.staff_no]},n={};n.product_id=k.value.product_id,n[e.key]=a[e.key],"4"===e.id&&(n[e.key]=["4"]),k.value[e.key]=n[e.key]}T.value?ye():le(k.value)},changeSearch:function(e){var t=JSON.parse(JSON.stringify(e));for(var a in t.product_id=k.value.product_id,e)k.value[a]=e[a];k.value.product_module_id||(k.value.product_module_id=[-1]),T.value?ye():le(k.value),setTimeout((function(){Q(k.value.product_id)}),500)},handleCreatePlan:function(){var e=Se();u.push({name:"planManagement",params:{planIds:e}})},drawer:F,onHandle:function(e,t,a){if("cancel"===e)return F.value=!1;if("title"===a){var n={id:[t.id],field:"name",name:t.title};return t.title.length<4||t.title.length>100?l(400,"请输入4-100个字数内的标题"):(w.value.name=t.title,void je(n,"edit"))}if(t.id){var r={id:[t.id]};"rich"===t.who?(r.description=t.rich,w.value.description=t.rich,r.field="description"):(r.origin_remark=t.rich2,w.value.origin_remark=t.rich2,r.field="origin_remark"),je(r,"edit")}else{var o;if(!t.title)return l(400,"标题不能为空");if(t.title.length<4||t.title.length>100)return l(400,"请输入4-100个字数内的标题");if(w.value.name=t.title,w.value.description=t.rich,w.value.origin_remark=t.rich2,w.value.hours){if(Number(w.value.hours)<0)return l(400,"请输入大于0的正整数");if(!/^\+?[0-9][0-9]*$/.test(w.value.hours))return l(400,"请输入大于0的正整数")}w.value.hours=1*w.value.hours;var i=JSON.parse(JSON.stringify(w.value));if(i.product_id=null===(o=c.value)||void 0===o?void 0:o.id,i.demand_status=1*w.value.demand_status,i.level=1*w.value.level,i.iteration_id||(i.iteration_id=0),!i.staff_no)return l(400,"指派给不能为空");je(i,"add")}},demandForm:w,headerTitle:s,iterationList:ee,richStatus:N,rich2Status:x,editOrAddDemand:je,basicsOption:De,handleBasicChange:function(e){if("product_module_id"!==e[0]){if(e[1]){var t={id:Se()},a=m.value.getCheckedNodes()[0].value;if(t[e[0]]=a,["demand_status","level"].includes(e[0]))t[e[0]]=1*a;else if("staff_no"===e[0]){var n=G.value.filter((function(e){return e.value===a}));t.staff_name=n[0].label}else"product_module_id"===e[0]&&(t.product_module_id=1*t.product_module_id);t.field=e[0],Fe(t)}else"origin"===e[0]?S.value=1:S.value=2,O.value=!0;null==f||f.value.handleClose()}else _.value=!0},basicBtn:f,dialogShadow:function(e){b.value=e},type:M,show:b,staff:p,cascaderPanel:m,onChangeType:function(e,t,a){var n={id:[t.id]};"hours"===a?(n.hours=Number(e.label),n.field="hours"):"staff"===a?(n.staff_no=e.value,n.staff_name=null==e?void 0:e.label,n.field="staff_no"):(n.field="demand_status",n.demand_status=Number(e.value)),Fe(n)},basicUserList:G,onChangeVal:function(e){var t={id:e.ids,hours:e.hours,field:"hours"};Fe(t)},currentActive:v,logArr:re,onChangeDemand:function(e){oe(e)},dialogDemand:O,updateVal:function(e){if("no"!==e){if(1===S.value){var t={id:Se(),field:"origin",origin:e};Fe(t)}else{var a=e;a.id=Se(),Fe(a)}O.value=!1}else _e(I.value.getCurrentPage(),void 0,k.value)},dialogType:S,demandFormParams:ke,onChangeSelect:function(e,t,a){var n={id:[t.id],field:a};if("staff_no"===a){var r=G.value.filter((function(t){return t.value===e}));n.staff_no=r[0].value,n.staff_name=r[0].label}"level"===a&&(n.level=e),"demand_status"===a&&(n.demand_status=e),Fe(n)},handleLoad:function(e){pe?pe++:0===pe&&(pe=1,Oe(e)),setTimeout((function(){pe=0}),1e3)},product_module_name:g,isOpenEditModule:_,handleUpdateModule:function(){if(ie.product_module_id>=0)return Fe(ie),void(_.value=!1)},handleCancle:function(){P.value=[],_.value=!1,_e(I.value.getCurrentPage(),void 0,k.value)},handleChangeModule:ue,moduleId:j,moduleTree:de,getModuleSelectTree:se})}}),Je=(a("e406"),a("6b0d"));const qe=a.n(Je)()(Ae,[["render",function(e,t,a,r,R,U){var z,A,J=Object(n.resolveComponent)("search-form"),q=Object(n.resolveComponent)("el-button"),Y=Object(n.resolveComponent)("sort"),H=Object(n.resolveComponent)("el-icon"),K=Object(n.resolveComponent)("el-table-column"),G=Object(n.resolveComponent)("selectOption"),Q=Object(n.resolveComponent)("InputOption"),$=Object(n.resolveComponent)("page-table"),W=Object(n.resolveComponent)("ArrowUp"),X=Object(n.resolveComponent)("el-cascader-panel"),Z=Object(n.resolveComponent)("el-dropdown"),ee=Object(n.resolveComponent)("form-demand"),te=Object(n.resolveComponent)("Drawer"),ae=Object(n.resolveComponent)("dialog-demand"),ne=Object(n.resolveComponent)("module-select"),re=Object(n.resolveComponent)("el-dialog"),oe=Object(n.resolveDirective)("infinite-scroll"),le=Object(n.resolveDirective)("debounce");return Object(n.openBlock)(),Object(n.createElementBlock)("div",o,[Object(n.createVNode)($,{tableData:e.list,onSortChange:e.sortChange,onHandleSelectionChange:e.handleSelectionChange,onHandlePagationChange:e.getData,total:e.total,hiddenPagation:"comePlan"===e.comePlan,currentPage:e.currentPage,highlight:!0,ref:"pageTableRef"},Object(n.createSlots)({_:2},["comePlan"!=e.comePlan?{name:"header",fn:Object(n.withCtx)((function(){var a;return[Object(n.createElementVNode)("div",l,[Object(n.createVNode)(J,{searchArray:e.searchArray,ref:"demandFormParams",currentActive:e.currentActive,onQuickSeacrh:e.quickSeacrh,onChangeSearch:e.changeSearch},null,8,["searchArray","currentActive","onQuickSeacrh","onChangeSearch"]),Object(n.createElementVNode)("div",c,[Object(n.createVNode)(q,{plain:"",onClick:e.exportTaskDate},{default:Object(n.withCtx)((function(){return[i]})),_:1},8,["onClick"]),1===(null===(a=e.curProductInfo)||void 0===a?void 0:a.is_approval)?(Object(n.openBlock)(),Object(n.createBlock)(q,{key:0,type:"primary",plain:"",onClick:t[0]||(t[0]=function(t){return e.handleUpdateAssign(3)})},{default:Object(n.withCtx)((function(){return[u]})),_:1})):Object(n.createCommentVNode)("",!0),Object(n.createVNode)(q,{plain:"",onClick:t[1]||(t[1]=function(t){return e.isShow=!e.isShow})},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(H,{style:{transform:"rotate(90deg)"}},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(Y)]})),_:1}),Object(n.createTextVNode)(" "+Object(n.toDisplayString)(e.isShow?" 列表":" 看板"),1)]})),_:1}),Object(n.createVNode)(q,{type:"primary",onClick:e.handleAddDemand},{default:Object(n.withCtx)((function(){return[d]})),_:1},8,["onClick"])])])]}))}:void 0,e.isShow?{name:"main",fn:Object(n.withCtx)((function(){return["comePlan"!=e.comePlan?(Object(n.openBlock)(),Object(n.createBlock)(K,{key:0,type:"selection",width:"55"})):Object(n.createCommentVNode)("",!0),Object(n.createVNode)(K,{sortable:"custom",prop:"id",label:"ID",width:"80"}),Object(n.createVNode)(K,{sortable:"custom","class-name":"table-column-left table-title","min-width":200,prop:"name",label:"需求名称"},{default:Object(n.withCtx)((function(t){return[Object(n.createElementVNode)("span",{class:"app-name",onClick:function(a){return e.handleDetail(t.row)}},Object(n.toDisplayString)(t.row.name),9,s)]})),_:1}),Object(n.createVNode)(K,{sortable:"custom",class:"eee",prop:"level",width:"150",label:"优先级"},{default:Object(n.withCtx)((function(t){return[Object(n.createVNode)(G,{valueKey:["id","value"],keyVal:"level",currentVal:t.row.level,type:1,currentType:"level",item:t.row,optionsData:e.PRIORITY,onOnChangeSelect:e.onChangeSelect},null,8,["currentVal","item","optionsData","onOnChangeSelect"])]})),_:1}),Object(n.createVNode)(K,{sortable:"custom",prop:"demand_status",width:"120",label:"状态"},{default:Object(n.withCtx)((function(t){return[Object(n.createElementVNode)("div",null,[1===t.row.demand_status?(Object(n.openBlock)(),Object(n.createElementBlock)("span",m,"待审核")):3===t.row.demand_status?(Object(n.openBlock)(),Object(n.createElementBlock)("span",f,"审批中")):(Object(n.openBlock)(),Object(n.createBlock)(G,{key:2,valueKey:["value","label"],keyVal:"demand_status",currentType:"status",currentVal:t.row.demand_status,type:1,item:t.row,optionsData:e.DEMAND_STATUS,onOnChangeSelect:e.onChangeSelect},null,8,["currentVal","item","optionsData","onOnChangeSelect"]))])]})),_:1}),Object(n.createVNode)(K,{sortable:"custom",prop:"staff_name",width:"140",label:"指派给"},{default:Object(n.withCtx)((function(t){return[Object(n.createVNode)(G,{valueKey:["staff_no","staff_name"],keyVal:"staff_no",currentVal:t.row.staff_name,type:0,currentType:"staff_no",item:t.row,optionsData:e.userList,onOnChangeSelect:e.onChangeSelect},null,8,["currentVal","item","optionsData","onOnChangeSelect"])]})),_:1}),Object(n.createVNode)(K,{sortable:"custom",prop:"hours",width:"120",label:"预计工时"},{default:Object(n.withCtx)((function(t){return[Object(n.createVNode)(Q,{inputVal:t.row.hours,currentId:t.row.id,onOnChangeVal:e.onChangeVal,valKey:"hours"},null,8,["inputVal","currentId","onOnChangeVal"])]})),_:1}),Object(n.createVNode)(K,{sortable:"custom",prop:"create_time","min-width":"220",label:"创建时间"}),Object(n.createVNode)(K,{width:"100",label:"操作"},{default:Object(n.withCtx)((function(t){return[Object(n.createVNode)(q,{class:"delete",link:"",onClick:function(a){return e.handlebatchCancel(t.row.id)}},{default:Object(n.withCtx)((function(){return[Object(n.createTextVNode)(Object(n.toDisplayString)("comePlan"===e.comePlan?"移除":"删除"),1)]})),_:2},1032,["onClick"])]})),_:1})]}))}:void 0]),1032,["tableData","onSortChange","onHandleSelectionChange","onHandlePagationChange","total","hiddenPagation","currentPage"]),e.isShow?Object(n.createCommentVNode)("",!0):(Object(n.openBlock)(),Object(n.createElementBlock)("div",b,[Object(n.createElementVNode)("ul",p,[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(e.demandData,(function(t,a){return Object(n.openBlock)(),Object(n.createElementBlock)("li",{key:a,class:"demand-list-cloumn"},[Object(n.createElementVNode)("div",{class:"demand-title",style:Object(n.normalizeStyle)({background:t.titleColor})},Object(n.toDisplayString)(t.titleName),5),Object(n.withDirectives)((Object(n.openBlock)(),Object(n.createElementBlock)("div",v,[Object(n.createElementVNode)("div",null,[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(t.listData,(function(a,r){return Object(n.openBlock)(),Object(n.createElementBlock)("div",{class:"demand-show-content",style:Object(n.normalizeStyle)({background:t.status?"#e1effb":"rgb(230, 252, 247)"}),key:r},[Object(n.createElementVNode)("p",{style:{"word-break":"break-all","word-wrap":"break-word"},onClick:Object(n.withModifiers)((function(t){return e.handleDetail(a)}),["stop"])},Object(n.toDisplayString)(a.name),9,O),2===a.status?(Object(n.openBlock)(),Object(n.createElementBlock)("div",h,[Object(n.createElementVNode)("span",null,Object(n.toDisplayString)(a.creator),1),Object(n.createElementVNode)("span",null,Object(n.toDisplayString)(a.create_time),1)])):Object(n.createCommentVNode)("",!0),2===a.status?(Object(n.openBlock)(),Object(n.createElementBlock)("div",j,"来源： "+Object(n.toDisplayString)(a.origin_path?a.origin_path+"/"+a.origin_staff:""),1)):Object(n.createCommentVNode)("",!0),[4,5,6].includes(a.status)?(Object(n.openBlock)(),Object(n.createElementBlock)("div",_,[Object(n.createElementVNode)("div",{class:"content-plan",onClick:function(t){return e.handleShowPlan(a.plan_name)}},"计划： "+Object(n.toDisplayString)(a.plan_name||"无"),9,g),Object(n.createElementVNode)("div",k,"负责人: "+Object(n.toDisplayString)(a.staff_name||"无"),1)])):Object(n.createCommentVNode)("",!0),[7].includes(a.status)?(Object(n.openBlock)(),Object(n.createElementBlock)("div",y,[Object(n.createElementVNode)("div",{class:"content-plan",onClick:function(t){return e.jupmIteration(a.iteration_id)}},"迭代： "+Object(n.toDisplayString)(a.iteration_name),9,C),Object(n.createElementVNode)("div",w,"周期: "+Object(n.toDisplayString)(a.iteration_dev_time)+" - "+Object(n.toDisplayString)(a.iteration_release_time),1)])):Object(n.createCommentVNode)("",!0)],4)})),128)),Object(n.createElementVNode)("div",V,[Object(n.withDirectives)(Object(n.createElementVNode)("span",null,"┗( ▔, ▔ )┛没有更多了...",512),[[n.vShow,!t.hasData&&1!==t.page_size]])])])])),[[oe,function(){return e.handleLoad(t)}]])])})),128))],512)])),null!==(z=e.selectedList)&&void 0!==z&&z.length?(Object(n.openBlock)(),Object(n.createElementBlock)("div",N,[Object(n.createVNode)(Z,{size:"small",placement:"top-start",trigger:"click",ref:"basicBtn"},{dropdown:Object(n.withCtx)((function(){return[Object(n.createVNode)(X,{style:{height:"220px"},"popper-class":"cascader-panel",onChange:e.handleBasicChange,ref:"cascaderPanel",options:e.basicsOption},null,8,["onChange","options"])]})),default:Object(n.withCtx)((function(){return[Object(n.createVNode)(q,null,{default:Object(n.withCtx)((function(){return[x,Object(n.createVNode)(H,null,{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(W)]})),_:1})]})),_:1})]})),_:1},512),Object(n.createVNode)(q,{style:{"margin-left":"10px"},onClick:t[2]||(t[2]=function(t){return e.handleCreatePlan()})},{default:Object(n.withCtx)((function(){return[F,S]})),_:1}),1===(null===(A=e.curProductInfo)||void 0===A?void 0:A.is_approval)?(Object(n.openBlock)(),Object(n.createBlock)(q,{key:0,style:{"margin-left":"10px"},onClick:t[3]||(t[3]=function(t){return e.handleUpdateAssign(1)})},{default:Object(n.withCtx)((function(){return[D,B]})),_:1})):Object(n.createCommentVNode)("",!0),Object(n.createVNode)(q,{onClick:t[4]||(t[4]=function(t){return e.handlebatchCancel()})},{default:Object(n.withCtx)((function(){return[E,T]})),_:1})])):Object(n.createCommentVNode)("",!0),Object(n.createVNode)(te,{drawer:e.drawer,"onUpdate:drawer":t[5]||(t[5]=function(t){return e.drawer=t}),title:e.demandForm.name,headerTitle:e.headerTitle,id:e.demandForm.id,onOnHandle:e.onHandle,rich:e.demandForm.description,rich2:e.demandForm.origin_remark,richStatus:e.richStatus,placeholder:"建议参考的模板： 作为一名<某种类型的用户>，我希望<达成某些目的>，这样可以<开发的价值>",rich2Status:e.rich2Status,statusList:e.logArr,loading:e.loading},{form:Object(n.withCtx)((function(){return[Object(n.createVNode)(ee,{userList:e.userList,onOnChangeTask:e.onChangeDemand,iterationList:e.iterationList,demandForm:e.demandForm},null,8,["userList","onOnChangeTask","iterationList","demandForm"])]})),_:1},8,["drawer","title","headerTitle","id","onOnHandle","rich","rich2","richStatus","rich2Status","statusList","loading"]),Object(n.createVNode)(ae,{onUpdateVal:e.updateVal,userList:e.userList,type:e.dialogType,visible:e.dialogDemand,"onUpdate:visible":t[6]||(t[6]=function(t){return e.dialogDemand=t})},null,8,["onUpdateVal","userList","type","visible"]),Object(n.createVNode)(re,{center:"",title:"更新模块",modelValue:e.isOpenEditModule,"onUpdate:modelValue":t[8]||(t[8]=function(t){return e.isOpenEditModule=t}),onClose:e.handleCancle,width:"30%"},{footer:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("span",P,[Object(n.createVNode)(q,{onClick:e.handleCancle},{default:Object(n.withCtx)((function(){return[L]})),_:1},8,["onClick"]),Object(n.withDirectives)((Object(n.openBlock)(),Object(n.createBlock)(q,{type:"primary",onClick:e.handleUpdateModule},{default:Object(n.withCtx)((function(){return[M]})),_:1},8,["onClick"])),[[le]])])]})),default:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",I,[Object(n.createVNode)(ne,{value:e.moduleId,"onUpdate:value":t[7]||(t[7]=function(t){return e.moduleId=t}),list:e.moduleTree,onUpdateUseCase:e.getModuleSelectTree,onChange:e.handleChangeModule},null,8,["value","list","onUpdateUseCase","onChange"])])]})),_:1},8,["modelValue","onClose"])])}],["__scopeId","data-v-61fe755f"]]);t.default=qe}}]);