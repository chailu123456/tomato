(window.webpackJsonp=window.webpackJsonp||[]).push([["dashboard~homepage~usecase~workItem"],{"0853":function(e,t,n){},"168e":function(e,t,n){},3411:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return l}));var r=[{id:1,value:"L0",color:"#dd0101"},{id:2,value:"L1",color:"#f56c6c"},{id:3,value:"L2",color:"#e6a23c"},{id:4,value:"L3",color:"#6a7e02"}],a=[{value:1,label:"冒烟用例"},{value:2,label:"功能用例"}],l=[{value:1,label:"已通过",color:"#1f9f85"},{value:2,label:"未通过",color:"#f56c6c"},{value:3,label:"阻 塞",color:"#f56c6c"},{value:4,label:"锁 定",color:"#e6a23c"},{value:5,label:"未执行",color:"#666"}]},"4c91":function(e,t,n){"use strict";n("acbf")},"4fba":function(e,t,n){"use strict";var r=n("1da1"),a=n("5530"),l=(n("96cf"),n("a9e3"),n("b0c0"),n("a4d3"),n("e01a"),n("159b"),n("7a23")),o=n("38d1"),c=n("81ab"),u=n("aa80"),d=n("eaf6"),i=n("0613"),m=n("0472"),s=(n("7db0"),n("d81d"),n("fb6a"),n("4de4"),n("caad"),n("2532"),n("a434"),n("23c4")),b=n("d257"),f=n("b23d"),p=n("f6f2"),O=n("3532"),j=n("5a0c"),v=n.n(j),_=n("2ef0"),h=n("8fa4f"),k=n("b3ae"),y=n("867b"),F=function(e){return Object(l.pushScopeId)("data-v-f6ef4fb0"),e=e(),Object(l.popScopeId)(),e},V={class:"rp-form-content"},g={key:0,style:{"margin-left":"10px",color:"#606266"}},x={key:1,style:{"margin-left":"10px",color:"#606266"}},w={key:2},C={style:{display:"flex","align-items":"center","margin-left":"10px"}},B={class:"default-form-item"},N={class:"default-form-item",style:{width:"100%",height:"30px"}},E={class:"default-form-item"},D={class:"default-form-item"},L={class:"default-form-item"},U={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},Y=F((function(){return Object(l.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1)})),R={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},I=F((function(){return Object(l.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1)})),M={class:"file-list"},T=F((function(){return Object(l.createElementVNode)("div",{class:"file-title"},"附件",-1)})),S={class:"upload-icon"},z={class:"list-detail"},A=["onClick"],q={class:"detail-right"},H=Object(l.defineComponent)({props:{iterationList:{type:Array,default:function(){return[]}},demandForm:{type:Object,default:function(){}}},emits:["onChangeTask"],setup:function(e,t){var n,a=t.emit,c=e,u=Object(d.a)().tipMessage,m=Object(b.G)("user",!0),j=Object(i.c)(),F=Object(l.ref)({}),H=Object(l.computed)((function(){var e;return null==j||null===(e=j.getters)||void 0===e?void 0:e.productInfo})),G=Object(l.ref)(),J=Object(l.reactive)({name:[{message:"请输入长度在 4 到 100 个字符",trigger:"blur"},{min:4,max:100,message:"请输入长度在 4 到 100 个字符",trigger:"blur"}],region:[{message:"Please select Activity zone",trigger:"change"}],hours:[{type:"number",message:"请输入0-100之间的数字",trigger:"change"},{min:0,max:100,message:"请输入0-100之间的数字",trigger:"blur"}],actual_hours:[{type:"number",message:"请输入0-100之间的数字",trigger:"change"},{min:0,max:100,message:"请输入0-100之间的数字",trigger:"blur"}]}),P=function e(t){for(var n=[],r=0;r<t.length;r+=1){var a={};a.value=t[r].id,a.label=t[r].name,a.level=t[r].level,a.parent_id=t[r].parent_id,a.product_id=t[r].product_id,t[r].children&&t[r].children.length&&(a.children=e(t[r].children)),n.push(a)}return n},K=Object(l.ref)(c.iterationList),$=function(e){Object(y.a)()(e).then((function(e){e&&e.length?K.value=e:K.value=[]}))},X=Object(l.ref)(),Q=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a,l,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(c.demandForm.product_module_id===t&&(c.demandForm.product_module_id=n||0),o={id:[c.demandForm.id],product_module_id:0,product_module_name:(null===(l=X.value[0])||void 0===l?void 0:l.name)||"",field:"product_module_id"},se(o)),e.next=3,Object(k.a)({id:null===(r=H.value)||void 0===r?void 0:r.id,name:null===(a=H.value)||void 0===a?void 0:a.name});case 3:null!=(u=e.sent)&&u.length&&(X.value=u,X.value.unshift({value:-1,label:"管理模块",level:-1,id:-1,name:"管理模块"}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),W=Object(l.ref)([]),Z=function(e){e&&Object(o.e)({product_id:e}).then((function(e){e.data&&e.data.length?W.value=e.data:W.value=[]}))},ee=function(e){!K.value.length&&e&&$(c.demandForm.product_id)},te=function(e){if(c.demandForm.product_module_id=e.value,c.demandForm.product_module_name=e.label,c.demandForm.id){var t={id:[c.demandForm.id],product_module_id:e.value,product_module_name:e.label,field:"product_module_id"};se(t)}},ne=Object(l.computed)((function(){return j.getters.productList})),re=Object(l.ref)([]),ae=function(){c.demandForm.product_id&&Object(o.N)({product_id:c.demandForm.product_id}).then(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.data&&t.data.length?(re.value=t.data,re.value.unshift({id:0,name:"主干"}),re.value.unshift({id:-1,name:"+ 添加模块"}),re.value=P(re.value)):(re.value=[],re.value.unshift({id:0,name:"主干"}),re.value.unshift({id:-1,name:"+ 添加模块"}),re.value=P(re.value));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},le=Object(l.ref)(!1),oe=function(){le.value=!0},ce=Object(l.computed)((function(){return c.demandForm.attachment})),ue=function(e,t,n){if(le.value=!1,e.url){var r=n.slice().map((function(e){return{title:e.name,addr:e.response?e.response.url:e.url,size:e.response?e.response.size:e.size,file_type:e.response?e.response.file_type:"",creator:null==m?void 0:m.name,create_time:v()().format("YYYY-MM-DD HH:mm:ss")}}));if(ce.value.unshift(r[r.length-1]),c.demandForm.attachment=ce.value,!c.demandForm.id)return;var a={id:[c.demandForm.id],attachment:ce.value,field:"attachment"};se(a)}},de=c.demandForm.hours||0,ie=0;ie=(null===(n=c.demandForm)||void 0===n?void 0:n.actual_hours)||0,Object(l.watch)((function(){return c.demandForm}),(function(e,t){t&&(e.product_id!==t.product_id&&e.product_id!==t.product_id&&($(e.product_id),ae(),Z(e.product_id)),Q(),F.value=JSON.parse(JSON.stringify(c.demandForm)),de=c.demandForm.hours||0,ie=c.demandForm.actual_hours?c.demandForm.actual_hours:0)}),{immediate:!0});var me=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a,l,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("product_id"!==n){e.next=8;break}return c.demandForm.iteration_id=null,c.demandForm.product_module_id=0,c.demandForm.product_module_name="主干",e.next=6,$(t);case 6:return e.next=8,ae();case 8:if(r={id:[c.demandForm.id]},"hours"!==n&&"actual_hours"!==n){e.next=37;break}if(""!==t){e.next=14;break}return"hours"===n&&(c.demandForm.hours=de),"actual_hours"===n&&(c.demandForm.actual_hours=ie),e.abrupt("return",u(400,"请输入大于0的正整数"));case 14:if(!Object(_.isNumber)(1*t)){e.next=36;break}if(!(Number(t)<0)){e.next=19;break}return"hours"===n&&(c.demandForm.hours=de),"actual_hours"===n&&(c.demandForm.actual_hours=ie),e.abrupt("return",u(400,"请输入大于0的正整数"));case 19:if(a=/^\+?[0-9][0-9]*$/,"hours"!==n){e.next=27;break}if(a.test(c.demandForm.hours)){e.next=24;break}return c.demandForm.hours=de,e.abrupt("return",u(400,"请输入大于0的正整数"));case 24:if(!(Number(t)>1e3)){e.next=27;break}return c.demandForm.hours=de,e.abrupt("return",u(400,"请输入0-1000之间的正整数"));case 27:if("actual_hours"!==n){e.next=34;break}if(a.test(c.demandForm.actual_hours)){e.next=31;break}return c.demandForm.actual_hours=ie,e.abrupt("return",u(400,"请输入大于0的正整数"));case 31:if(!(Number(t)>1e3)){e.next=34;break}return c.demandForm.actual_hours=ie,e.abrupt("return",u(400,"请输入0-1000之间的正整数"));case 34:e.next=37;break;case 36:return e.abrupt("return",u(400,"请输入大于0的正整数"));case 37:if(!c.demandForm.name){e.next=40;break}if(!(c.demandForm.name.length<3||c.demandForm.name.length>100)){e.next=40;break}return e.abrupt("return",u(400,"请输入长度在 4 到 100 个字符"));case 40:if("staff_no"===n&&W.value&&(l=W.value[1],o=l.options.filter((function(e){return e.staff_no===t})),r.staff_name=o[0].staff_name,c.demandForm.staff_name=o[0].staff_name,c.demandForm.staff_no=o[0].staff_no),"iteration_id"===n&&(t||(t=0)),r[n]=t,["demand_status","level","hours","actual_hours"].includes(n)&&(r[n]=1*t),"hours"!==n&&"actual_hours"!==n||(c.demandForm[n]=r[n]),"start_time"!==n&&"end_time"!==n){e.next=53;break}if(!c.demandForm.start_time||!c.demandForm.end_time){e.next=53;break}if(!(c.demandForm.start_time>c.demandForm.end_time)){e.next=53;break}return u(400,"计划开始时间不能大于结束时间"),c.demandForm.start_time=F.value.start_time,c.demandForm.end_time=F.value.end_time,e.abrupt("return");case 53:if(c.demandForm.id){e.next=55;break}return e.abrupt("return");case 55:r.field=n,se(r);case 57:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),se=function(e){Object(o.q)(e).then((function(t){if(200===t.code)return a("onChangeTask",c.demandForm.id),"staff_no"===e.field&&setTimeout((function(){Z(c.demandForm.product_id)}),500),e.demand_status&&5==e.demand_status?u(200,"修改成功，请填写消耗工时，以便记录工作情况"):u(200,"成功")}))},be=function(e){if(c.demandForm.origin=e,c.demandForm.id){var t={id:[c.demandForm.id],origin:e,field:"origin"};se(t)}};return function(t,n){var r=Object(l.resolveComponent)("el-option"),a=Object(l.resolveComponent)("el-select"),o=Object(l.resolveComponent)("el-form-item"),u=Object(l.resolveComponent)("el-option-group"),d=Object(l.resolveComponent)("module-select"),i=Object(l.resolveComponent)("el-date-picker"),m=Object(l.resolveComponent)("el-input"),b=Object(l.resolveComponent)("el-form"),j=Object(l.resolveComponent)("el-icon"),v=Object(l.resolveComponent)("el-upload"),_=Object(l.resolveDirective)("loading");return Object(l.openBlock)(),Object(l.createElementBlock)("div",V,[Object(l.createVNode)(b,{model:e.demandForm,ref_key:"ruleFormRef",ref:G,rules:Object(l.unref)(J),"label-position":"left","label-width":"100px"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{label:"需求类型",prop:"type"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,class:"reset-select",onChange:n[0]||(n[0]=function(e){return me(e,"type")}),filterable:"",modelValue:e.demandForm.type,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.demandForm.type=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.B),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.value,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"状态"},{default:Object(l.withCtx)((function(){return[1==e.demandForm.demand_status?(Object(l.openBlock)(),Object(l.createElementBlock)("span",g,"待审核")):3==e.demandForm.demand_status?(Object(l.openBlock)(),Object(l.createElementBlock)("span",x,"审批中")):(Object(l.openBlock)(),Object(l.createElementBlock)("div",w,[Object(l.createVNode)(a,{teleported:!1,disabled:!e.demandForm.id,class:"reset-select",onChange:n[2]||(n[2]=function(e){return me(e,"demand_status")}),filterable:"",modelValue:e.demandForm.demand_status,"onUpdate:modelValue":n[3]||(n[3]=function(t){return e.demandForm.demand_status=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.g),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,disabled:e.disabled,value:e.value},null,8,["label","disabled","value"])})),128))]})),_:1},8,["disabled","modelValue"])]))]})),_:1}),Object(l.createVNode)(o,{label:"指派给",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,class:"reset-select",onChange:n[4]||(n[4]=function(e){return me(e,"staff_no")}),filterable:"",modelValue:e.demandForm.staff_name,"onUpdate:modelValue":n[5]||(n[5]=function(t){return e.demandForm.staff_name=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(W.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(u,{key:e.staff_no,label:e.label},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(e.options,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.staff_no,label:e.staff_name,value:e.staff_no},null,8,["label","value"])})),128))]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"优先级",prop:"level"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",C,[Object(l.createElementVNode)("div",{style:Object(l.normalizeStyle)({width:"8px",height:"8px",marginRight:"4px",display:"inline-block",borderRadius:"50%",background:(t=e.demandForm.level,o=s.f.find((function(e){return e.value==t})),null==o?void 0:o.color)})},null,4),Object(l.createVNode)(a,{teleported:!1,onChange:n[6]||(n[6]=function(e){return me(e,"level")}),class:"reset-select",style:{display:"flex",flex:1},filterable:"",modelValue:e.demandForm.level,"onUpdate:modelValue":n[7]||(n[7]=function(t){return e.demandForm.level=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.f),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])];var t,o})),_:1}),Object(l.createVNode)(o,{label:"归属项目",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,onChange:n[8]||(n[8]=function(e){return me(e,"product_id")}),class:"reset-select",filterable:"",modelValue:e.demandForm.product_id,"onUpdate:modelValue":n[9]||(n[9]=function(t){return e.demandForm.product_id=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(ne),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"所属模块"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",B,[Object(l.createVNode)(d,{value:e.demandForm.product_module_id,"onUpdate:value":n[10]||(n[10]=function(t){return e.demandForm.product_module_id=t}),list:X.value,onUpdateUseCase:Q,onChange:te},null,8,["value","list"])])]})),_:1}),Object(l.createVNode)(o,{label:"迭代"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,onChange:n[11]||(n[11]=function(e){return me(e,"iteration_id")}),class:"reset-select",filterable:"",clearable:"",onVisibleChange:ee,modelValue:e.demandForm.iteration_name,"onUpdate:modelValue":n[12]||(n[12]=function(t){return e.demandForm.iteration_name=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(K.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"来源人"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",N,[Object(l.createVNode)(h.a,{onUpdateOrigin:be,val:e.demandForm.origin_staff},null,8,["val"])])]})),_:1}),Object(l.createVNode)(o,{label:"收集时间"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",E,[Object(l.createVNode)(i,{"value-format":"YYYY-MM-DD",onChange:n[13]||(n[13]=function(e){return me(e,"collect_time")}),modelValue:e.demandForm.collect_time,"onUpdate:modelValue":n[14]||(n[14]=function(t){return e.demandForm.collect_time=t}),type:"date",size:"default",placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(l.createVNode)(o,{label:"计划开始时间"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",D,[Object(l.createVNode)(i,{"value-format":"YYYY-MM-DD",onChange:n[15]||(n[15]=function(e){return me(e,"start_time")}),modelValue:e.demandForm.start_time,"onUpdate:modelValue":n[16]||(n[16]=function(t){return e.demandForm.start_time=t}),type:"date",size:"default",placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(l.createVNode)(o,{label:"计划完成时间"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",L,[Object(l.createVNode)(i,{"value-format":"YYYY-MM-DD",onChange:n[17]||(n[17]=function(e){return me(e,"end_time")}),modelValue:e.demandForm.end_time,"onUpdate:modelValue":n[18]||(n[18]=function(t){return e.demandForm.end_time=t}),type:"date",placeholder:"请选择日期",size:"default",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(l.createVNode)(o,{label:"预计工时"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",U,[Object(l.createVNode)(m,{type:"number",onChange:n[19]||(n[19]=function(e){return me(e,"hours")}),modelValue:e.demandForm.hours,"onUpdate:modelValue":n[20]||(n[20]=function(t){return e.demandForm.hours=t})},null,8,["modelValue"]),Y])]})),_:1}),e.demandForm.id?(Object(l.openBlock)(),Object(l.createBlock)(o,{key:0,label:"实际工时"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",R,[Object(l.createVNode)(m,{type:"number",onChange:n[21]||(n[21]=function(e){return me(e,"actual_hours")}),modelValue:e.demandForm.actual_hours,"onUpdate:modelValue":n[22]||(n[22]=function(t){return e.demandForm.actual_hours=t})},null,8,["modelValue"]),I])]})),_:1})):Object(l.createCommentVNode)("",!0)]})),_:1},8,["model","rules"]),Object(l.createElementVNode)("div",M,[T,Object(l.createElementVNode)("div",null,[Object(l.withDirectives)((Object(l.openBlock)(),Object(l.createBlock)(v,{"show-file-list":!1,"before-upload":oe,"on-success":ue,action:Object(l.unref)(f.a).uploadAssets,multiple:!1},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("span",S,[Object(l.createVNode)(j,null,{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Plus))]})),_:1})])]})),_:1},8,["action"])),[[_,le.value]]),Object(l.createElementVNode)("ul",z,[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(ce),(function(e,t){return Object(l.openBlock)(),Object(l.createElementBlock)("li",{key:e.addr,onClick:function(t){return n=e,void Object(O.a)(n.title,n.addr);var n}},[Object(l.createVNode)(j,{class:"list-detail-icon"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Document))]})),_:1}),Object(l.createElementVNode)("div",q,[Object(l.createVNode)(j,{class:"icon-remove",onClick:Object(l.withModifiers)((function(e){return function(e){ce.value.splice(e,1);var t={id:[c.demandForm.id],attachment:ce.value,field:"attachment"};c.demandForm.id&&se(t)}(t)}),["stop"])},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Close))]})),_:2},1032,["onClick"]),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.title),1),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.creator)+" "+Object(l.toDisplayString)(e.create_time),1)])],8,A)})),128))])])])])}}}),G=(n("5462"),n("ed4c"),n("6b0d")),J=n.n(G)()(H,[["__scopeId","data-v-f6ef4fb0"]]),P=n("6c02"),K={class:"rp-form-content"},$={style:{display:"flex","align-items":"center","margin-left":"10px"}},X={class:"default-form-item"},Q={class:"default-form-item"},W={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},Z=Object(l.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1),ee={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},te=Object(l.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1),ne={class:"file-list"},re=Object(l.createElementVNode)("div",{class:"file-title"},"附件",-1),ae={class:"upload-icon"},le={class:"list-detail"},oe=["onClick"],ce={class:"detail-right"},ue=Object(l.defineComponent)({props:{iterationList:{type:Array,default:function(){return[]}},demandForm:{type:Object,default:function(){}}},emits:["onChangeTask"],setup:function(e,t){var n,a,u=t.emit,m=e,j=Object(i.c)(),h=Object(P.f)(),k=Object(l.ref)(h.currentRoute.value.meta.onIteration),F=Object(l.ref)(!1),V=Object(d.a)().tipMessage,g=Object(b.G)("user",!0),x=JSON.parse(JSON.stringify(s.w)),w=Object(l.ref)([]),C=function(e){e&&Object(o.e)({product_id:e}).then((function(e){e.data&&e.data.length?w.value=e.data:w.value=[]}))},B=Object(l.ref)([]),N=function(e){Object(y.a)()(e).then((function(e){e&&e.length?B.value=e:B.value=[]}))},E=Object(l.ref)({}),D=Object(l.computed)((function(){return j.getters.productList})),L=Object(l.ref)([]),U=function(e,t){Object(c.t)({product_id:e,iteration_id:t||0}).then((function(e){L.value=e.data}))},Y=function(){F.value=!0},R=Object(l.computed)((function(){return m.demandForm.attachment})),I=function(e,t,n){if(F.value=!1,e.url){var r=n.slice().map((function(e){return{name:e.name,url:e.response?e.response.url:e.url,size:e.response?e.response.size:e.size,file_type:e.response?e.response.file_type:"",creator:null==g?void 0:g.name,create_time:v()().format("YYYY-MM-DD HH:mm:ss")}}));if(R.value.unshift(r[r.length-1]),m.demandForm.attachment=R.value,!m.demandForm.id)return;var a={ids:[m.demandForm.id],attachment:R.value,field:"attachment"};z(a)}},M=(null===(n=m.demandForm)||void 0===n?void 0:n.hours)||0,T=(null===(a=m.demandForm)||void 0===a?void 0:a.real_hours)||0;Object(l.watch)((function(){return m.demandForm}),(function(e,t){var n,r;if(t&&(E.value=JSON.parse(JSON.stringify(m.demandForm)),M=null===(n=m.demandForm)||void 0===n?void 0:n.hours,T=null===(r=m.demandForm)||void 0===r?void 0:r.real_hours,e.product_id)){if(e.product_id===t.product_id&&e.iteration_id===t.iteration_id)return;e.product_id!==t.product_id&&(N(e.product_id),C(e.product_id)),U(e.product_id,e.iteration_id)}}),{immediate:!0});var S=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a,l,o,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("product_id"!==n){e.next=8;break}return m.demandForm.iteration_id=null,m.demandForm.demand_id=null,m.demandForm.demand_name="",e.next=6,N(t);case 6:return e.next=8,U(t,m.demandForm.iteration_id);case 8:if("iteration_id"!==n){e.next=15;break}return m.demandForm.demand_id=null,m.demandForm.demand_name="",t||(t=0),t||(m.demandForm.iteration_id=null),e.next=15,U(m.demandForm.product_id,m.demandForm.iteration_id);case 15:if("demand_id"===n&&(t||(t=0),m.demandForm.demand_id=t),"hours"!==n&&"real_hours"!==n){e.next=42;break}if(""!==t){e.next=21;break}return"hours"===n&&(m.demandForm.hours=M),"real_hours"===n&&(m.demandForm.real_hours=T),e.abrupt("return",V(400,"请输入大于0的正整数"));case 21:if(!Object(_.isNumber)(1*t)){e.next=39;break}if(/^\+?[0-9][0-9]*$/.test(t)){e.next=27;break}return"hours"===n&&(m.demandForm.hours=M),"real_hours"===n&&(m.demandForm.real_hours=T),e.abrupt("return",V(400,"请输入大于0的正整数"));case 27:if(!(Number(t)<=0)){e.next=33;break}if("hours"!==n){e.next=31;break}return m.demandForm.hours=M,e.abrupt("return",V(400,"预计工时请输入大于0的正整数"));case 31:return"real_hours"===n&&(m.demandForm.real_hours=T),e.abrupt("return",V(400,"请输入大于0的正整数"));case 33:if(!(Number(t)>999)){e.next=37;break}return"hours"===n&&(m.demandForm.hours=M),"real_hours"===n&&(m.demandForm.real_hours=T),e.abrupt("return",V(400,"请输入0到999的正整数"));case 37:e.next=40;break;case 39:return e.abrupt("return",V(400,"请输入0到999的正整数"));case 40:M=null===(r=m.demandForm)||void 0===r?void 0:r.hours,T=null===(a=m.demandForm)||void 0===a?void 0:a.real_hours;case 42:if(l={ids:[m.demandForm.id]},"staff_no"===n&&w.value&&(o=w.value[1],c=o.options.filter((function(e){return e.staff_no===t})),l.staff_name=c[0].staff_name,m.demandForm.staff_name=c[0].staff_name,m.demandForm.staff_no=c[0].staff_no),l[n]=t,["status","level","hours","real_hours"].includes(n)&&(l[n]=1*t),"hours"!==n&&"real_hours"!==n||(m.demandForm[n]=l[n]),"begin_time"!==n&&"end_time"!==n){e.next=55;break}if(!m.demandForm.begin_time||!m.demandForm.end_time){e.next=55;break}if(!(m.demandForm.begin_time>m.demandForm.end_time)){e.next=55;break}return V(400,"计划开始时间不能大于结束时间"),m.demandForm.begin_time=null===(u=E.value)||void 0===u?void 0:u.begin_time,m.demandForm.end_time=E.value.end_time,e.abrupt("return");case 55:if(l.field=n,m.demandForm.id){e.next=58;break}return e.abrupt("return");case 58:"status"===n&&(2!==m.demandForm.status||m.demandForm.real_hours||(m.demandForm.real_hours=m.demandForm.hours,l.real_hours=m.demandForm.real_hours)),z(l);case 60:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=function(e){Object(c.K)(e).then((function(t){if(200===t.code){if(u("onChangeTask",m.demandForm.id),"staff_no"===e.field&&setTimeout((function(){C(m.demandForm.product_id)}),500),!e.status||!e.real_hours)return V(200,"成功");V(200,"保存成功，实际工时的值已默认填充预计工时。")}}))};return Object(l.onMounted)((function(){})),function(t,n){var r=Object(l.resolveComponent)("el-option"),a=Object(l.resolveComponent)("el-select"),o=Object(l.resolveComponent)("el-form-item"),c=Object(l.resolveComponent)("el-option-group"),u=Object(l.resolveComponent)("el-date-picker"),d=Object(l.resolveComponent)("el-input"),i=Object(l.resolveComponent)("el-form"),b=Object(l.resolveComponent)("el-icon"),j=Object(l.resolveComponent)("el-upload"),v=Object(l.resolveDirective)("loading");return Object(l.openBlock)(),Object(l.createElementBlock)("div",K,[Object(l.createVNode)(i,{model:e.demandForm,ref:"ruleFormRef","label-position":"left","label-width":"100px"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{label:"任务类型",prop:"type"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,class:"reset-select",onChange:n[0]||(n[0]=function(e){return S(e,"type")}),filterable:"",modelValue:e.demandForm.type,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.demandForm.type=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.y),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"状态"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,class:"reset-select",onChange:n[2]||(n[2]=function(e){return S(e,"status")}),filterable:"",disabled:!m.demandForm.id,modelValue:e.demandForm.status,"onUpdate:modelValue":n[3]||(n[3]=function(t){return e.demandForm.status=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(x),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["disabled","modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"指派给",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,class:"reset-select",onChange:n[4]||(n[4]=function(e){return S(e,"staff_no")}),filterable:"",modelValue:e.demandForm.staff_name,"onUpdate:modelValue":n[5]||(n[5]=function(t){return e.demandForm.staff_name=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(w.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(c,{key:e.staff_no,label:e.label},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(e.options,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.staff_no,label:e.staff_name,value:e.staff_no},null,8,["label","value"])})),128))]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"优先级",prop:"level"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",$,[Object(l.createElementVNode)("em",{style:Object(l.normalizeStyle)({width:"8px",height:"8px",marginRight:"4px",display:"inline-block",borderRadius:"5px",background:(t=e.demandForm.level,o=s.f.find((function(e){return e.value==t})),null==o?void 0:o.color)})},null,4),Object(l.createVNode)(a,{style:{display:"flex",flex:1},teleported:!1,onChange:n[6]||(n[6]=function(e){return S(e,"level")}),class:"reset-select",filterable:"",modelValue:e.demandForm.level,"onUpdate:modelValue":n[7]||(n[7]=function(t){return e.demandForm.level=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.f),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])];var t,o})),_:1}),Object(l.createVNode)(o,{label:"所属项目",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,onChange:n[8]||(n[8]=function(e){return S(e,"product_id")}),class:"reset-select",filterable:"",disabled:!k.value&&!e.demandForm.id,modelValue:e.demandForm.product_id,"onUpdate:modelValue":n[9]||(n[9]=function(t){return e.demandForm.product_id=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(D),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["disabled","modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"所属迭代"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,onChange:n[10]||(n[10]=function(e){return S(e,"iteration_id")}),class:"reset-select",filterable:"",clearable:"",disabled:!k.value&&!e.demandForm.id,modelValue:e.demandForm.iteration_id,"onUpdate:modelValue":n[11]||(n[11]=function(t){return e.demandForm.iteration_id=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(B.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["disabled","modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"关联需求"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(a,{teleported:!1,onChange:n[12]||(n[12]=function(e){return S(e,"demand_id")}),class:"reset-select",filterable:"",clearable:"",modelValue:e.demandForm.demand_name,"onUpdate:modelValue":n[13]||(n[13]=function(t){return e.demandForm.demand_name=t}),placeholder:"请选择需求"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(L.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(o,{label:"计划开始时间"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",X,[Object(l.createVNode)(u,{"value-format":"YYYY-MM-DD",onChange:n[14]||(n[14]=function(e){return S(e,"begin_time")}),modelValue:e.demandForm.begin_time,"onUpdate:modelValue":n[15]||(n[15]=function(t){return e.demandForm.begin_time=t}),type:"date",size:"default",clearable:!1,placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(l.createVNode)(o,{label:"计划完成时间"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",Q,[Object(l.createVNode)(u,{"value-format":"YYYY-MM-DD",onChange:n[16]||(n[16]=function(e){return S(e,"end_time")}),modelValue:e.demandForm.end_time,"onUpdate:modelValue":n[17]||(n[17]=function(t){return e.demandForm.end_time=t}),type:"date",size:"default",clearable:!1,placeholder:"请选择日期",style:{width:"100%"}},null,8,["modelValue"])])]})),_:1}),Object(l.createVNode)(o,{label:"预计工时"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",W,[Object(l.createVNode)(d,{type:"number",onChange:n[18]||(n[18]=function(e){return S(e,"hours")}),modelValue:e.demandForm.hours,"onUpdate:modelValue":n[19]||(n[19]=function(t){return e.demandForm.hours=t})},null,8,["modelValue"]),Z])]})),_:1}),e.demandForm.id?(Object(l.openBlock)(),Object(l.createBlock)(o,{key:0,label:"实际工时"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",ee,[Object(l.createVNode)(d,{type:"number",onChange:n[20]||(n[20]=function(e){return S(e,"real_hours")}),modelValue:e.demandForm.real_hours,"onUpdate:modelValue":n[21]||(n[21]=function(t){return e.demandForm.real_hours=t})},null,8,["modelValue"]),te])]})),_:1})):Object(l.createCommentVNode)("",!0)]})),_:1},8,["model"]),Object(l.createElementVNode)("div",ne,[re,Object(l.createElementVNode)("div",null,[Object(l.withDirectives)((Object(l.openBlock)(),Object(l.createBlock)(j,{"show-file-list":!1,"before-upload":Y,"on-success":I,action:Object(l.unref)(f.a).uploadAssets,multiple:!1},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("span",ae,[Object(l.createVNode)(b,null,{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Plus))]})),_:1})])]})),_:1},8,["action"])),[[v,F.value]]),Object(l.createElementVNode)("ul",le,[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(R),(function(e,t){return Object(l.openBlock)(),Object(l.createElementBlock)("li",{key:e.addr,onClick:function(t){return n=e,void Object(O.a)(n.name||n.title,n.url);var n}},[Object(l.createVNode)(b,{class:"list-detail-icon"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Document))]})),_:1}),Object(l.createElementVNode)("div",ce,[Object(l.createVNode)(b,{class:"icon-remove",onClick:Object(l.withModifiers)((function(e){return function(e){if(R.value.splice(e,1),m.demandForm.id){var t={ids:[m.demandForm.id],attachment:R.value,field:"attachment"};m.demandForm.id&&z(t)}}(t)}),["stop"])},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Close))]})),_:2},1032,["onClick"]),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.name),1),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.creator)+" "+Object(l.toDisplayString)(e.create_time),1)])],8,oe)})),128))])])])])}}});n("bdf3"),n("d5dd");var de=ue,ie=n("9fe0"),me=n("7085"),se=n("afbc"),be={class:"rp-form-content"},fe={style:{display:"flex","align-items":"center","margin-left":"10px"}},pe={class:"default-form-item",style:{display:"flex","align-items":"center",width:"100px"}},Oe=Object(l.createElementVNode)("i",{style:{width:"30px",position:"absolute",left:"110px"}},"小时",-1),je={class:"file-list"},ve=Object(l.createElementVNode)("div",{class:"file-title"},"附件",-1),_e={class:"upload-icon"},he={class:"list-detail"},ke=["onClick"],ye={class:"detail-right"},Fe=Object(l.defineComponent)(Object(a.a)(Object(a.a)({},{name:"FormBug"}),{},{props:{drawerForm:{type:Object,default:function(){}},currIterateId:{type:Number,default:0}},emits:["onHandle"],setup:function(e,t){var n=t.emit,a=e,o=Object(l.computed)((function(){return se.a.currentRoute.value.meta.inIteration})),m=Object(i.c)(),j=Object(d.a)().tipMessage,h=Object(b.G)("user",!0),k=Object(l.computed)((function(){return m.getters.productList})),y=Object(l.computed)((function(){return se.a.currentRoute.value})),F=Object(l.ref)([]),V=Object(l.ref)([]),g=Object(l.ref)([]),x=Object(l.ref)([]),w=Object(l.ref)([]),C=Object(l.ref)(),B={staff_no:[{required:!0,message:"请选择指派人",trigger:"blur"}],level:[{required:!0,message:"请选择级别",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"blur"}],product_id:[{required:!0,message:"请选择项目",trigger:"blur"}]},N=b.b.slice().splice(1,b.b.length),E=function(e){Object(ie.h)({product_id:e,iteration_id:a.currIterateId}).then((function(e){var t,n,r,l;200===e.code?w.value=e.data:w.value=[],w.value[1]&&(Object(_.find)(null===(t=w.value[1])||void 0===t?void 0:t.options,(function(e){var t;return(null===(t=a.drawerForm)||void 0===t?void 0:t.staff_no)===e.staff_no}))||(null===(n=a.drawerForm)||void 0===n?void 0:n.staff_no)===(null===(r=a.drawerForm)||void 0===r?void 0:r.staff_name)||(a.drawerForm.staff_no=null===(l=a.drawerForm)||void 0===l?void 0:l.staff_name))}))},D=function(e){Object(me.a)({product_id:e}).then((function(e){200===e.code?F.value=e.data:F.value=[]}))},L=function(e){Object(c.t)({product_id:e}).then((function(e){200===e.code?V.value=e.data:V.value=[]}))},U=function(e){var t={product_id:e,iteration_id:o.value?a.currIterateId:0};Object(c.m)(t).then((function(e){200===e.code?g.value=e.data:g.value=[]}))},Y=function(e){var t={product_id:e,iteration_id:o.value?a.currIterateId:0};Object(c.C)(t).then((function(e){200===e.code?x.value=e.data:x.value=[]}))},R=Object(l.computed)((function(){return a.drawerForm.attachment})),I=function(e,t,n){if(T.value=!1,e.url){var r=n.slice().map((function(e){return{title:e.name,addr:e.response?e.response.url:e.url,size:e.response?e.response.size:e.size,file_type:e.response?e.response.file_type:"",creator:null==h?void 0:h.name,create_time:v()().format("YYYY-MM-DD HH:mm:ss")}}));if(R.value.unshift(r[r.length-1]),a.drawerForm.attachment=R.value,!a.drawerForm.id)return;var l={id:[a.drawerForm.id],attachment:R.value,field:"attachment"};M(l)}},M=function(e,t){var r;null===(r=C.value)||void 0===r||r.validate((function(r){r&&Object(u.o)(e).then((function(r){if(200===r.code)return n("onHandle",e.id[0]),j(200,t||"成功")}))}))},T=Object(l.ref)(!1),S=function(){T.value=!0},z=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("product_id"!==n){e.next=15;break}return a.drawerForm.task_id=null,a.drawerForm.demand_id=null,a.drawerForm.iteration_id="",a.drawerForm.test_case_id=null,e.next=7,E(t);case 7:return e.next=9,D(t);case 9:return e.next=11,L(t);case 11:return e.next=13,U(t);case 13:return e.next=15,Y(t);case 15:if(a.drawerForm.id){e.next=17;break}return e.abrupt("return");case 17:if(r={id:[a.drawerForm.id],field:"".concat(n)},"hours"!==n){e.next=25;break}if(/^\+?[0-9][0-9]*$/.test(t)){e.next=22;break}return e.abrupt("return",j(400,"请输入大于0的正整数"));case 22:if(!((t=parseInt(t,10))>999||t<=0)){e.next=25;break}return e.abrupt("return",j(400,"请输入0到999的正整数"));case 25:["env","iteration_id","demand_id","task_id","test_case_id","cause"].includes(n)&&!t?r[n]=0:r[n]=t,M(r);case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(l.watch)((function(){return a.drawerForm.id}),(function(e){var t=a.drawerForm.product_id;t&&(E(t),D(t),L(t),U(t),Y(t))}),{immediate:!0,deep:!0}),function(t,n){var r=Object(l.resolveComponent)("el-option"),o=Object(l.resolveComponent)("el-select"),c=Object(l.resolveComponent)("el-form-item"),u=Object(l.resolveComponent)("el-option-group"),d=Object(l.resolveComponent)("el-input"),i=Object(l.resolveComponent)("el-form"),m=Object(l.resolveComponent)("el-icon"),j=Object(l.resolveComponent)("el-upload"),v=Object(l.resolveDirective)("loading");return Object(l.openBlock)(),Object(l.createElementBlock)("div",be,[Object(l.createVNode)(i,{model:e.drawerForm,rules:B,ref_key:"ruleFormRef",ref:C,"label-position":"left","label-width":"100px"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(c,{label:"类型",prop:"type"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[0]||(n[0]=function(e){return z(e,"type")}),popperAppendToBody:!1,class:"reset-select",filterable:"",modelValue:e.drawerForm.type,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.drawerForm.type=t}),placeholder:"请选择类型"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(b.c),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"状态",prop:"status"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[2]||(n[2]=function(e){return function(e,t){if(a.drawerForm.id){var n="";[4,5].includes(e)&&(n="状态修改成功，请填写解决方案。"),[2].includes(e)&&(n="状态已修改为已解决，请填写修复耗时。");var r={id:[a.drawerForm.id],field:"".concat(t)};r[t]=e,M(r,n)}}(e,"status")}),popperAppendToBody:!1,class:"reset-select",filterable:"",disabled:!e.drawerForm.id,modelValue:e.drawerForm.status,"onUpdate:modelValue":n[3]||(n[3]=function(t){return e.drawerForm.status=t}),placeholder:"请选择状态"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(N),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["disabled","modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"指派给",prop:"staff_no"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[4]||(n[4]=function(e){return z(e,"staff_no")}),popperAppendToBody:!1,class:"reset-select",filterable:"",modelValue:e.drawerForm.staff_no,"onUpdate:modelValue":n[5]||(n[5]=function(t){return e.drawerForm.staff_no=t}),placeholder:"请选择指派人"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(w.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(u,{key:e.staff_no,label:e.label},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(e.options,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.staff_no,label:e.staff_name,value:e.staff_no},null,8,["label","value"])})),128))]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"级别",prop:"level"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[6]||(n[6]=function(e){return z(e,"level")}),popperAppendToBody:!1,class:"reset-select",filterable:"",modelValue:e.drawerForm.level,"onUpdate:modelValue":n[7]||(n[7]=function(t){return e.drawerForm.level=t}),placeholder:"请选择级别"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(b.a),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"优先级",prop:"priority"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",fe,[Object(l.createElementVNode)("em",{style:Object(l.normalizeStyle)({width:"8px",height:"8px",marginRight:"4px",display:"inline-block",borderRadius:"5px",background:(t=e.drawerForm.priority,a=s.p.find((function(e){return e.id==t})),null==a?void 0:a.color)})},null,4),Object(l.createVNode)(o,{style:{display:"flex",flex:1},popperAppendToBody:!1,onChange:n[8]||(n[8]=function(e){return z(e,"priority")}),class:"reset-select",filterable:"",modelValue:e.drawerForm.priority,"onUpdate:modelValue":n[9]||(n[9]=function(t){return e.drawerForm.priority=t}),placeholder:"请选择优先级"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.p),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.value,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])];var t,a})),_:1}),Object(l.createVNode)(c,{label:"所属环境",prop:"env"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[10]||(n[10]=function(e){return z(e,"env")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.env,"onUpdate:modelValue":n[11]||(n[11]=function(t){return e.drawerForm.env=t}),placeholder:"请选择环境"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(b.g),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.value,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"所属项目",prop:"product_id",required:""},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[12]||(n[12]=function(e){return z(e,"product_id")}),popperAppendToBody:!1,class:"reset-select",filterable:"",modelValue:e.drawerForm.product_id,"onUpdate:modelValue":n[13]||(n[13]=function(t){return e.drawerForm.product_id=t}),placeholder:"请选择项目",disabled:Object(l.unref)(y).meta.inIteration},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(k),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","disabled"])]})),_:1}),Object(l.createVNode)(c,{label:"所属迭代",prop:"iteration_id"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[14]||(n[14]=function(e){return z(e,"iteration_id")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.iteration_id,"onUpdate:modelValue":n[15]||(n[15]=function(t){return e.drawerForm.iteration_id=t}),placeholder:"请选择迭代",disabled:Object(l.unref)(y).meta.inIteration},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(F.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","disabled"])]})),_:1}),Object(l.createVNode)(c,{label:"关联需求",prop:"demand_id"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[16]||(n[16]=function(e){return z(e,"demand_id")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.demand_id,"onUpdate:modelValue":n[17]||(n[17]=function(t){return e.drawerForm.demand_id=t}),placeholder:"请选择需求"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(V.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"关联任务",prop:"task_id"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[18]||(n[18]=function(e){return z(e,"task_id")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.task_id,"onUpdate:modelValue":n[19]||(n[19]=function(t){return e.drawerForm.task_id=t}),placeholder:"请选择任务"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(g.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"关联用例",prop:"test_case_id"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[20]||(n[20]=function(e){return z(e,"test_case_id")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.test_case_id,"onUpdate:modelValue":n[21]||(n[21]=function(t){return e.drawerForm.test_case_id=t}),placeholder:"请选择用例",disabled:Object(l.unref)(y).meta.inIteration&&"useCase"===Object(l.unref)(se.a).currentRoute.value.name},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(x.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","disabled"])]})),_:1}),e.drawerForm.id?(Object(l.openBlock)(),Object(l.createBlock)(c,{key:0,label:"解决方案",prop:"cause"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{onChange:n[22]||(n[22]=function(e){return z(e,"cause")}),popperAppendToBody:!1,class:"reset-select",filterable:"",clearable:"",modelValue:e.drawerForm.cause,"onUpdate:modelValue":n[23]||(n[23]=function(t){return e.drawerForm.cause=t}),placeholder:"请选择解决方案"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(s.s),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})):Object(l.createCommentVNode)("",!0),e.drawerForm.id?(Object(l.openBlock)(),Object(l.createBlock)(c,{key:1,label:"修复耗时",prop:"hours"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",pe,[Object(l.createVNode)(d,{type:"number",onChange:n[24]||(n[24]=function(e){return z(e,"hours")}),modelValue:e.drawerForm.hours,"onUpdate:modelValue":n[25]||(n[25]=function(t){return e.drawerForm.hours=t})},null,8,["modelValue"]),Oe])]})),_:1})):Object(l.createCommentVNode)("",!0)]})),_:1},8,["model"]),Object(l.createElementVNode)("div",je,[ve,Object(l.createElementVNode)("div",null,[Object(l.withDirectives)((Object(l.openBlock)(),Object(l.createBlock)(j,{"before-upload":S,"show-file-list":!1,"on-success":I,action:Object(l.unref)(f.a).uploadAssets,multiple:!1},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("span",_e,[Object(l.createVNode)(m,null,{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Plus))]})),_:1})])]})),_:1},8,["action"])),[[v,T.value]]),Object(l.createElementVNode)("ul",he,[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(R),(function(e){return Object(l.openBlock)(),Object(l.createElementBlock)("li",{key:e.addr,onClick:function(t){return n=e,void Object(O.a)(n.title,n.addr);var n}},[Object(l.createVNode)(m,{class:"list-detail-icon"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Document))]})),_:1}),Object(l.createElementVNode)("div",ye,[Object(l.createVNode)(m,{class:"icon-remove",onClick:Object(l.withModifiers)((function(t){return function(e){if(R.value.splice(e,1),a.drawerForm.id){var t={id:[a.drawerForm.id],attachment:R.value,field:"attachment"};M(t)}}(e)}),["stop"])},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Close))]})),_:2},1032,["onClick"]),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.title),1),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.creator)+" "+Object(l.toDisplayString)(e.create_time),1)])],8,ke)})),128))])])])])}}}));n("6640"),n("ce60");var Ve=Fe,ge=n("3411"),xe={class:"rp-form-content"},we={class:"default-form-item"},Ce={class:"file-list"},Be=Object(l.createElementVNode)("div",{class:"file-title"},"附件",-1),Ne={class:"upload-icon"},Ee={class:"list-detail"},De=["onClick"],Le={class:"detail-right"},Ue=Object(l.defineComponent)({props:{iterationList:{type:Array,default:function(){return[]}},demandForm:{type:Object,default:function(){}}},emits:["onChangeTask"],setup:function(e,t){var n=t.emit,a=e,u=Object(i.c)(),m=Object(l.ref)(!1),s=Object(l.computed)((function(){var e;return null===(e=u.getters)||void 0===e?void 0:e.iterateId})),j=Object(l.computed)((function(){var e;return null==u||null===(e=u.getters)||void 0===e?void 0:e.productInfo})),_=Object(d.a)().tipMessage,h=Object(b.G)("user",!0),y=Object(l.ref)([]),F=function(e){e&&Object(o.e)({product_id:e}).then((function(e){e.data&&e.data.length?y.value=e.data:y.value=[]}))},V=Object(l.ref)([]),g=Object(l.ref)(),x=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,l,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(a.demandForm.product_module_id===t&&(a.demandForm.product_module_id=0),o={ids:[a.demandForm.id],product_module_id:0,product_module_name:(null===(l=g.value[0])||void 0===l?void 0:l.name)||"",field:"product_module_id"},a.demandForm.id&&Y(o)),e.next=3,Object(k.a)({id:null===(n=j.value)||void 0===n?void 0:n.id,name:null===(r=j.value)||void 0===r?void 0:r.name});case 3:null!=(c=e.sent)&&c.length&&(g.value=c,g.value.unshift({value:-1,label:"管理模块",level:-1,id:-1,name:"管理模块"}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=Object(l.ref)([]),C=Object(l.computed)((function(){return u.getters.productList})),B=Object(l.ref)([]),N=function(){m.value=!0},E=Object(l.computed)((function(){return a.demandForm.attachment}))||Object(l.ref)([]),D=function(e,t,n){if(m.value=!1,e.url){var r=n.slice().map((function(e){return{name:e.name,url:e.response?e.response.url:e.url,size:e.response?e.response.size:e.size,file_type:e.response?e.response.file_type:"",creator:null==h?void 0:h.name,create_time:v()().format("YYYY-MM-DD HH:mm:ss")}}));if(E.value.unshift(r[r.length-1]),a.demandForm.attachment=E.value,!a.demandForm.id)return;var l={ids:[a.demandForm.id],attachment:E.value,field:"attachment"};Y(l)}};Object(l.watch)((function(){return a.demandForm}),(function(e){var t;e&&((t=Object(b.G)("iterateList",!0))&&t.length?w.value=t:w.value=[],x(),setTimeout((function(){var t,n;y.value.length||F(e.product_id),B.value.length||(t=e.product_id,n=e.iteration_id,Object(c.t)({product_id:t,iteration_id:n||0}).then((function(e){B.value=e.data}))),V.value.length||function(e,t){Object(c.m)({product_id:e,iteration_id:t||0}).then((function(e){200===e.code?V.value=e.data:V.value=[]}))}(e.product_id,e.iteration_id)}),300))}),{immediate:!0}),Object(l.watch)((function(){return s.value}),(function(){y.value=[],B.value=[],V.value=[]}));var L=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,l,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("demand_id"===n&&(t||(t=0),a.demandForm.demand_id=t),"task_id"===n&&(t||(t=0),a.demandForm.task_id=t),r={ids:[a.demandForm.id]},"staff_no"===n&&y.value&&(l=y.value[1],o=l.options.filter((function(e){return e.staff_no===t})),r.staff_name=o[0].staff_name,a.demandForm.staff_name=o[0].staff_name,a.demandForm.staff_no=o[0].staff_no),r[n]=t,["status","level","type"].includes(n)&&(r[n]=1*t),r.field=n,a.demandForm.id){e.next=10;break}return e.abrupt("return");case 10:Y(r);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),U=function(e){if(a.demandForm.product_module_id=e.value,a.demandForm.product_module_name=e.label,a.demandForm.id){var t={ids:[a.demandForm.id],product_module_id:e.value,product_module_name:e.label,field:"product_module_id"};Y(t)}},Y=function(e){Object(c.k)(e).then((function(t){if(200===t.code)return n("onChangeTask",a.demandForm.id),"staff_no"===e.field&&setTimeout((function(){F(a.demandForm.product_id)}),500),_(200,"成功")}))};return function(t,n){var r=Object(l.resolveComponent)("el-option"),o=Object(l.resolveComponent)("el-select"),c=Object(l.resolveComponent)("el-form-item"),u=Object(l.resolveComponent)("el-option-group"),d=Object(l.resolveComponent)("module-select"),i=Object(l.resolveComponent)("el-form"),s=Object(l.resolveComponent)("el-icon"),b=Object(l.resolveComponent)("el-upload"),j=Object(l.resolveDirective)("loading");return Object(l.openBlock)(),Object(l.createElementBlock)("div",xe,[Object(l.createVNode)(i,{model:e.demandForm,"label-position":"left","label-width":"100px"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(c,{label:"类型",prop:"type"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,class:"reset-select",onChange:n[0]||(n[0]=function(e){return L(e,"type")}),filterable:"",modelValue:e.demandForm.type,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.demandForm.type=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(ge.c),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"结果"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,class:"reset-select",onChange:n[2]||(n[2]=function(e){return L(e,"status")}),filterable:"",disabled:!a.demandForm.id,modelValue:e.demandForm.status,"onUpdate:modelValue":n[3]||(n[3]=function(t){return e.demandForm.status=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(ge.b),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["disabled","modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"等级",prop:"level"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,onChange:n[4]||(n[4]=function(e){return L(e,"level")}),class:"reset-select",filterable:"",modelValue:e.demandForm.level,"onUpdate:modelValue":n[5]||(n[5]=function(t){return e.demandForm.level=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(ge.a),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.value,label:e.value,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"所属项目",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,onChange:n[6]||(n[6]=function(e){return L(e,"product_id")}),class:"reset-select",filterable:"",disabled:!0,modelValue:e.demandForm.product_id,"onUpdate:modelValue":n[7]||(n[7]=function(t){return e.demandForm.product_id=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(C),(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"指派给",prop:"name"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,class:"reset-select",onChange:n[8]||(n[8]=function(e){return L(e,"staff_no")}),filterable:"",modelValue:e.demandForm.staff_name,"onUpdate:modelValue":n[9]||(n[9]=function(t){return e.demandForm.staff_name=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(y.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(u,{key:e.staff_no,label:e.label},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(e.options,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.staff_no,label:e.staff_name,value:e.staff_no},null,8,["label","value"])})),128))]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"关联模块"},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("div",we,[Object(l.createVNode)(d,{value:e.demandForm.product_module_id,"onUpdate:value":n[10]||(n[10]=function(t){return e.demandForm.product_module_id=t}),list:g.value,onUpdateUseCase:x,onChange:U},null,8,["value","list"])])]})),_:1}),Object(l.createVNode)(c,{label:"所属迭代"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,onChange:n[11]||(n[11]=function(e){return L(e,"iteration_id")}),class:"reset-select",filterable:"",clearable:"",disabled:!0,modelValue:e.demandForm.iteration_name,"onUpdate:modelValue":n[12]||(n[12]=function(t){return e.demandForm.iteration_name=t}),placeholder:"请选择"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(w.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"关联需求"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,onChange:n[13]||(n[13]=function(e){return L(e,"demand_id")}),class:"reset-select",filterable:"",clearable:"",modelValue:e.demandForm.demand_name,"onUpdate:modelValue":n[14]||(n[14]=function(t){return e.demandForm.demand_name=t}),placeholder:"请选择需求"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(B.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l.createVNode)(c,{label:"关联任务"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(o,{teleported:!1,onChange:n[15]||(n[15]=function(e){return L(e,"task_id")}),class:"reset-select",filterable:"",clearable:"",modelValue:e.demandForm.task_name,"onUpdate:modelValue":n[16]||(n[16]=function(t){return e.demandForm.task_name=t}),placeholder:"请选择任务"},{default:Object(l.withCtx)((function(){return[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(V.value,(function(e){return Object(l.openBlock)(),Object(l.createBlock)(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1},8,["model"]),Object(l.createElementVNode)("div",Ce,[Be,Object(l.createElementVNode)("div",null,[Object(l.withDirectives)((Object(l.openBlock)(),Object(l.createBlock)(b,{"show-file-list":!1,"before-upload":N,"on-success":D,action:Object(l.unref)(f.a).uploadAssets,multiple:!1},{default:Object(l.withCtx)((function(){return[Object(l.createElementVNode)("span",Ne,[Object(l.createVNode)(s,null,{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Plus))]})),_:1})])]})),_:1},8,["action"])),[[j,m.value]]),Object(l.createElementVNode)("ul",Ee,[(Object(l.openBlock)(!0),Object(l.createElementBlock)(l.Fragment,null,Object(l.renderList)(Object(l.unref)(E),(function(e,t){return Object(l.openBlock)(),Object(l.createElementBlock)("li",{key:e.addr,onClick:function(t){return n=e,void Object(O.a)(n.name||n.title,n.url);var n}},[Object(l.createVNode)(s,{class:"list-detail-icon"},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Document))]})),_:1}),Object(l.createElementVNode)("div",Le,[Object(l.createVNode)(s,{class:"icon-remove",onClick:Object(l.withModifiers)((function(e){return function(e){if(E.value.splice(e,1),a.demandForm.id){var t={ids:[a.demandForm.id],attachment:E.value,field:"attachment"};a.demandForm.id&&Y(t)}}(t)}),["stop"])},{default:Object(l.withCtx)((function(){return[Object(l.createVNode)(Object(l.unref)(p.Close))]})),_:2},1032,["onClick"]),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.name),1),Object(l.createElementVNode)("p",null,Object(l.toDisplayString)(e.creator)+" "+Object(l.toDisplayString)(e.create_time),1)])],8,De)})),128))])])])])}}});n("4c91"),n("9007");var Ye=Ue,Re=n("59a4"),Ie=Object(l.defineComponent)({name:"workDrawer"});const Me=Object(l.defineComponent)(Object(a.a)(Object(a.a)({},Ie),{},{props:{type:{type:Number,default:1},targetId:{type:Number,default:0},productId:{type:Number,default:0},iterationId:{type:Number,default:0}},emits:["refresh"],setup:function(e,t){var n,a,s,f,p=t.expose,O=t.emit,j=e,_=Object(b.G)("user",!0),h=Object(i.c)(),k=Object(d.a)().tipMessage,y=Object(P.f)(),F=Object(Re.a)(),V=F.useGetDemandDetail,g=F.useGetTaskDetail,x=F.useGetBugDetail,w=Object(l.computed)((function(){return h.getters.iterateId})),C=Object(l.computed)((function(){return h.getters.currentIter})),B=Object(l.computed)((function(){return h.getters.productInfo})),N=Object(l.ref)("view"),E=Object(l.ref)("view"),D=Object(l.ref)(!1),L={2:"查看任务",3:"查看Bug",5:"查看需求",9:"查看用例"},U=Object(l.ref)("新增"),Y=Object(l.ref)(!1),R=Object(l.ref)({5:{attachment:[],id:void 0,collect_time:v()().format("YYYY-MM-DD"),create_by:"",create_time:"",creator:"",delete_time:"",demand_status:1===(null===(n=B.value)||void 0===n?void 0:n.is_approval)?1:2,description:"",end_time:"",hours:0,iteration_id:null,iteration_name:"",level:"3",type:1,name:"",origin:"",origin_remark:"",origin_staff:"",product_id:null,product_module_id:0,product_module_name:"主干",product_name:"",staff_name:"",staff_no:"",start_time:"",status_list:[]},3:{id:null,env:1,type:1,hours:null,level:1,cause:null,status:0,task_id:null,priority:3,demand_id:null,test_case_id:null,name:"",remark:"",staff_no:"",task_name:"",staff_name:"",demand_name:"",test_case_name:"",description:"",iteration_id:"",iteration_name:"",list:[],attachment:[],product_name:"",product_id:j.productId},2:{id:null,attachment:[],begin_time:v()().format("YYYY-MM-DD"),status:0,content:"",end_time:v()().format("YYYY-MM-DD"),hours:0,real_hours:0,iteration_id:null,iteration_name:"",demand_id:null,level:"3",type:2,name:"",product_id:null,product_name:"",staff_name:"",staff_no:"",remark:"",description:""},9:{attachment:[],iteration_id:w.value,iteration_name:null===(a=C.value)||void 0===a?void 0:a.name,product_id:null===(s=B.value)||void 0===s?void 0:s.id,level:2,content:"",name:"",description:"<p><b>[前提]</b><br/><br/><br/><br/><b>[输入]<br/><br/></b><br/><br/><br/><b>[输出]<br/><br/><br/></b></p>",staff_name:null==_?void 0:_.name,staff_no:null==_?void 0:_.staff_no,remark:"",status:5,type:1,product_module_id:0,product_module_name:null===(f=B.value)||void 0===f?void 0:f.name,demand_id:null,task_id:null}}),I=function(e){var t=e.id,n=e.env,r=e.type,a=e.hours,l=e.level,o=e.cause,c=e.status,u=e.task_id,d=e.priority,i=e.demand_id,m=e.test_case_id,s=e.name,b=e.remark,f=e.staff_no,p=e.task_name,O=e.staff_name,v=e.demand_name,_=e.product_name,h=e.test_case_name,k=e.iteration_id,y=e.iteration_name,F=e.attachment,V=e.description,g=e.product_id;R.value[j.type].env=n||null,R.value[j.type].type=r||null,R.value[j.type].id=t||null,R.value[j.type].level=l||null,R.value[j.type].cause=o||null,R.value[j.type].task_id=u||null,R.value[j.type].priority=d||null,R.value[j.type].demand_id=i||null,R.value[j.type].test_case_id=m||null,R.value[j.type].iteration_id=k||null,R.value[j.type].hours=a,R.value[j.type].name=s,R.value[j.type].remark=b,R.value[j.type].staff_no=f,R.value[j.type].status=c,R.value[j.type].task_name=p,R.value[j.type].staff_name=O,R.value[j.type].demand_name=v,R.value[j.type].product_name=_,R.value[j.type].test_case_name=h,R.value[j.type].iteration_name=y,R.value[j.type].attachment=F,R.value[j.type].description=V,R.value[j.type].product_id=g},M=[{type:2,request:c.j},{type:3,request:u.g},{type:5,request:o.E},{type:9,request:c.o}],T=Object(l.ref)([]),S=function(e){M.forEach((function(t){t.type===j.type&&t.request(e).then((function(e){e.data&&e.data.length?T.value=e.data:T.value=[]}))}))},z=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(5!==j.type){e.next=8;break}return e.next=3,V({id:t});case 3:n=e.sent,D.value=!1,n&&(R.value[j.type]=n,R.value[j.type].level=R.value[j.type].level+"",R.value[j.type].remark=R.value[j.type].origin_remark,R.value[j.type].iteration_id=R.value[j.type].iteration_id?R.value[j.type].iteration_id:null),e.next=30;break;case 8:if(2!==j.type){e.next=16;break}return e.next=11,g(t);case 11:r=e.sent,D.value=!1,r&&(R.value[j.type]=r,R.value[j.type].level=R.value[j.type].level+"",R.value[j.type].description=R.value[j.type].content,R.value[j.type].iteration_id=R.value[j.type].iteration_id?R.value[j.type].iteration_id:null,R.value[j.type].demand_id=R.value[j.type].demand_id?R.value[j.type].demand_id:null),e.next=30;break;case 16:if(3!==j.type){e.next=24;break}return e.next=19,x(t);case 19:a=e.sent,D.value=!1,a&&I(a),e.next=30;break;case 24:if(9!==j.type){e.next=30;break}return e.next=27,Object(c.X)(t);case 27:l=e.sent,D.value=!1,l.data&&(R.value[j.type]=null==l?void 0:l.data,R.value[j.type].description=R.value[j.type].content,R.value[j.type].iteration_id=R.value[j.type].iteration_id?R.value[j.type].iteration_id:null,R.value[j.type].demand_id=R.value[j.type].demand_id?R.value[j.type].demand_id:null,R.value[j.type].task_id=R.value[j.type].task_id?R.value[j.type].task_id:null,R.value[j.type].product_module_id=R.value[j.type].product_module_id,R.value[j.type].product_module_name=R.value[j.type].product_module_name);case 30:return e.next=32,S(t);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(l.watch)((function(){return j.targetId}),(function(e,t){var n,r;-1!==e&&("useCase"===y.currentRoute.value.name&&(e<=0||!t)?(U.value="新增",N.value="add",E.value="add",T.value=[],9===j.type&&(R.value[9]={attachment:[],iteration_id:w.value,iteration_name:C.value.name,product_id:null===(n=B.value)||void 0===n?void 0:n.id,level:2,name:"",description:"<p><b>[前提]</b><br/><br/><br/><br/><b>[输入]<br/><br/></b><br/><br/><br/><b>[输出]<br/><br/><br/></b></p>",staff_name:null==_?void 0:_.name,staff_no:null==_?void 0:_.staff_no,remark:"",status:5,type:1,product_module_id:0,product_module_name:null===(r=B.value)||void 0===r?void 0:r.name,demand_id:null,task_id:null}),3===j.type&&(U.value="新增BUG")):A(e))}));var A=function(e){N.value="view",E.value="view",z(e),D.value=!0,U.value=L[j.type]},q=function(e){Object(o.q)(e).then((function(e){if(200===e.code)return S(j.targetId),setTimeout((function(){return O("refresh")}),300),k(200,"成功")}))},H=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("title"!==n){e.next=7;break}if(r={id:[t.id],field:"name",name:t.title},!(t.title.length<4||t.title.length>100)){e.next=4;break}return e.abrupt("return",k(400,"请输入4-100个字数内的标题"));case 4:return R.value[j.type].name=t.title,q(r),e.abrupt("return");case 7:if(!t.id){e.next=12;break}return a={id:[t.id]},"rich"===t.who?(a.description=t.rich,R.value[j.type].description=t.rich,a.field="description"):(a.origin_remark=t.rich2,R.value[j.type].remark=t.rich2,a.field="origin_remark"),e.next=12,q(a);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(c.K)(t).then((function(e){if(200===e.code)return S(j.targetId),setTimeout((function(){return O("refresh")}),300),k(200,"成功")}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("title"!==n){e.next=9;break}if(r={ids:[t.id],field:"name",name:t.title},t.title){e.next=4;break}return e.abrupt("return",k(400,"标题不能为空"));case 4:if(!(t.title.length<1||t.title.length>50)){e.next=6;break}return e.abrupt("return",k(400,"请输入1-50个字数内的标题"));case 6:return R.value[j.type].name=t.title,G(r),e.abrupt("return");case 9:if(!t.id){e.next=14;break}return a={ids:[t.id]},"rich"===t.who?(a.content=t.rich,a.field="content",R.value[j.type].content=t.rich,R.value[j.type].description=t.rich):(a.remark=t.rich2,a.field="remark",R.value[j.type].remark=t.rich2),e.next=14,G(a);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(u.a)(t).then((function(e){if(200===e.code)return Y.value=!1,O("refresh"),k(200,"成功")}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(u.o)(t).then((function(e){if(200===e.code)return S(j.targetId),setTimeout((function(){return O("refresh")}),300),k(200,"成功")}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("title"!==n){e.next=8;break}if(r={id:[t.id],field:"name",name:t.title},!(t.title.length<4||t.title.length>100)){e.next=4;break}return e.abrupt("return",k(400,"请输入4-100个字数内的标题"));case 4:return R.value[j.type].name=t.title,e.next=7,X(r);case 7:return e.abrupt("return");case 8:if(!t.who){e.next=21;break}if(a={id:[t.id],field:""},"rich"===t.who?(a.field="description",a.description=t.rich,R.value[j.type].description=t.rich):(a.field="remark",a.remark=t.rich2,R.value[j.type].remark=t.rich2),!t.id){e.next=16;break}return e.next=14,X(a);case 14:e.next=18;break;case 16:return e.next=18,$(a);case 18:return e.abrupt("return");case 21:if(t.title){e.next=23;break}return e.abrupt("return",k(400,"标题不能为空"));case 23:if(R.value[j.type].name=t.title,R.value[j.type].description=t.rich,R.value[j.type].remark=t.rich2,(l={name:R.value[j.type].name,description:R.value[j.type].description,remark:R.value[j.type].remark,attachment:R.value[j.type].attachment,type:R.value[j.type].type,status:R.value[j.type].status,staff_no:R.value[j.type].staff_no,level:R.value[j.type].level,priority:R.value[j.type].priority,env:R.value[j.type].env,product_id:R.value[j.type].product_id,iteration_id:R.value[j.type].iteration_id,demand_id:R.value[j.type].demand_id,task_id:R.value[j.type].task_id,test_case_id:R.value[j.type].test_case_id}).staff_no){e.next=31;break}return e.abrupt("return",k(400,"请选择指派人"));case 31:$(l);case 32:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),W=function(e,t){t?Object(c.b)(e).then((function(e){if(200===e.code)return Y.value=!1,O("refresh"),k(200,"成功")})):Object(c.k)(e).then((function(e){if(200===e.code)return S(j.targetId),O("refresh"),k(200,"成功")}))},Z=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a,l,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("title"!==n){e.next=10;break}if(r={ids:[t.id],field:"name",name:t.title},t.title){e.next=4;break}return e.abrupt("return",k(400,"标题不能为空"));case 4:if(!(t.title.length<1||t.title.length>100)){e.next=6;break}return e.abrupt("return",k(400,"请输入1-100个字数内的标题"));case 6:return R.value[j.type].name=t.title,e.next=9,W(r);case 9:return e.abrupt("return");case 10:if(!t.id){e.next=18;break}return a={ids:[t.id]},"rich"===t.who?(a.content=t.rich,a.field="content",R.value[j.type].content=t.rich,R.value[j.type].description=t.rich):(a.remark=t.rich2,a.field="remark",R.value[j.type].remark=t.rich2),e.next=16,W(a);case 16:e.next=31;break;case 18:if(t.title){e.next=20;break}return e.abrupt("return",k(400,"标题不能为空"));case 20:if(!(t.title.length<1||t.title.length>100)){e.next=22;break}return e.abrupt("return",k(400,"请输入1-100个字数内的标题"));case 22:R.value[j.type].name=t.title,R.value[j.type].content=t.rich,R.value[j.type].remark=t.rich2,(o=JSON.parse(JSON.stringify(R.value[j.type]))).status=1*R.value[j.type].status,o.level=1*R.value[j.type].level,o.type=1*R.value[j.type].type,o.iteration_id=null!==(l=R.value[j.type].iteration_id)&&void 0!==l?l:0,W([o],"add");case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ee=function(e,t,n){if("cancel"===e)return Y.value=!1;5===j.type?H(t,n):2===j.type?K(t,n):3===j.type?Q(t,n):9===j.type&&Z(t,n)};p({handleDrawerVisble:function(e){return function(e){Y.value=e}(e)},resetUseCaseBug:function(e){return function(e){var t,n;R.value[3]={id:null,env:1,type:1,hours:null,level:1,cause:null,status:0,task_id:null,priority:3,demand_id:null,name:"",remark:"",staff_no:"",task_name:"",description:"<p><b>[步骤]</b><br/><br/><br/><b>[结果]<br/></b><br/><br/><b>[期望]<br/></b><br/><br/></p>",staff_name:"",demand_name:"",test_case_id:e.id,test_case_name:e.name,iteration_id:w.value,iteration_name:C.value.name,list:[],attachment:[],product_name:null===(t=B.value)||void 0===t?void 0:t.name,product_id:null===(n=B.value)||void 0===n?void 0:n.id}}(e)},getDetailData:function(e){return A(e)}}),Object(l.watch)((function(){return Y.value}),(function(e){e||"useCase"===y.currentRoute.value.name&&Object(b.K)()}));var te=function(e){S(e),setTimeout((function(){return O("refresh")}),300)};return function(t,n){var r,a,o,c;return Object(l.openBlock)(),Object(l.createBlock)(m.a,{drawer:Y.value,"onUpdate:drawer":n[0]||(n[0]=function(e){return Y.value=e}),title:null===(r=R.value[e.type])||void 0===r?void 0:r.name,headerTitle:U.value,id:null===(a=R.value[e.type])||void 0===a?void 0:a.id,onOnHandle:ee,rich:null===(o=R.value[e.type])||void 0===o?void 0:o.description,rich2:null===(c=R.value[e.type])||void 0===c?void 0:c.remark,richStatus:N.value,placeholder:"",rich2Status:E.value,statusList:T.value,maxlength:100,loading:D.value},{form:Object(l.withCtx)((function(){return[5===j.type?(Object(l.openBlock)(),Object(l.createBlock)(J,{key:0,onOnChangeTask:te,demandForm:R.value[e.type]},null,8,["demandForm"])):2===j.type?(Object(l.openBlock)(),Object(l.createBlock)(de,{key:1,onOnChangeTask:te,demandForm:R.value[e.type]},null,8,["demandForm"])):3===j.type?(Object(l.openBlock)(),Object(l.createBlock)(Ve,{key:2,drawerForm:R.value[e.type],currIterateId:e.iterationId,onOnHandle:te},null,8,["drawerForm","currIterateId"])):9===j.type?(Object(l.openBlock)(),Object(l.createBlock)(Ye,{key:3,onOnChangeTask:te,demandForm:R.value[9]},null,8,["demandForm"])):Object(l.createCommentVNode)("",!0)]})),_:1},8,["drawer","title","headerTitle","id","rich","rich2","richStatus","rich2Status","statusList","loading"])}}}));t.a=Me},5462:function(e,t,n){"use strict";n("56ec")},"56ec":function(e,t,n){},6640:function(e,t,n){"use strict";n("7f6b")},"7f6b":function(e,t,n){},"867b":function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("1da1"),a=(n("96cf"),n("81ab"));function l(){return function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(a.p)({product_id:t,status:-1});case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},9007:function(e,t,n){"use strict";n("f5ce")},acbf:function(e,t,n){},bdf3:function(e,t,n){"use strict";n("168e")},ce60:function(e,t,n){"use strict";n("0853")},ce65:function(e,t,n){},d256:function(e,t,n){},d5dd:function(e,t,n){"use strict";n("ce65")},ed4c:function(e,t,n){"use strict";n("d256")},f5ce:function(e,t,n){}}]);