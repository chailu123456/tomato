(window.webpackJsonp=window.webpackJsonp||[]).push([["pmo"],{"39d7":function(e,t,n){},"3fec":function(e,t,n){},"63a8":function(e,t,n){"use strict";n.r(t),n("b0c0");var r=n("7a23"),a=function(e){return Object(r.pushScopeId)("data-v-7e3fea8f"),e=e(),Object(r.popScopeId)(),e},c={class:"overview pmo",id:"overview"},o={class:"overview-search"},l=["onClick"],i={key:0},u={key:0},s=Object(r.createTextVNode)(" 成员： "),d={key:0},b={key:1,class:"percent percent-red"},m=Object(r.createTextVNode)(") "),p=a((function(){return Object(r.createElementVNode)("span",null,"●",-1)})),f=Object(r.createTextVNode)("   "),O={class:"flex-layout"},j=a((function(){return Object(r.createElementVNode)("span",null,"节点时间",-1)})),h={class:"overview-span"},v={class:"overview-span"},g={class:"overview-span"},_=n("5530"),w=n("ade3"),k=n("1da1"),y=(n("96cf"),n("4ec9"),n("d3b7"),n("3ca3"),n("ddb0"),n("159b"),n("4de4"),n("b64b"),n("caad"),n("a9e3"),n("ac1f"),n("1276"),n("d81d"),n("7db0"),n("25f0"),n("81ab"));function S(){return C.apply(this,arguments)}function C(){return(C=Object(k.a)(regeneratorRuntime.mark((function e(){var t,n,r,a,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:1,n=c.length>1&&void 0!==c[1]?c[1]:20,r=c.length>2?c[2]:void 0,e.next=5,Object(y.w)(Object(_.a)({pageIndex:t,pageSize:n},r));case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=n("d257"),N=n("913c"),V=n("bb3b"),D=n("6c02"),E=n("1edc"),B=n("6669"),T=n("71ee"),I=n("5a0c"),P=n.n(I),R=n("0613"),F=n("7b31"),A=n("2d40"),z=n("0a56"),L=Object(r.defineComponent)({name:"pmo",components:{IterationTip:E.a,FullScreen:T.a},setup:function(){var e=Object(r.ref)(!1),t=Object(r.ref)(),n=Object(r.reactive)({page_index:1,page_size:20,sort_name:void 0,sort_by:void 0,product_id:[],month:"",name:"",status:[],start_time:"",end_time:"",staff_no:"",demand_id:""}),a=Object(D.f)(),c=Object(x.G)("user",!0),o=Object(z.a)(),l=o.useInitGetProductList,i=o.useGetMultipleProductStaffList,u=o.useGetMultipleProductDemandList,s=o.boardBaseRt,d=new Map,b=Object(r.ref)("-1"),m=Object(r.reactive)({btnArray:[{id:"-1",label:"所有",key:"all"},{id:"0,1,2,3,4,5,7,8",label:"未完成",key:"status"},{id:"6",label:"已发布",key:"status"},{id:"3",label:"我参与的",key:"staff_no"},{id:"4",label:"本月",key:"month"},{id:"5",label:"上月",key:"month"}],searchForm:[{type:"input",label:"名称",key:"name",val:"",placeholder:"请输入迭代名称"},{type:"select",label:"状态",val:[],multiple:!0,key:"status",valueKey:["value","label"],listData:x.o},{type:"select",label:"成员",val:[],key:"staff_no",valueKey:["staff_no","staff_name"],listData:[]},{type:"select",selectType:"virtual",label:"关联需求",key:"demand_id",val:"",listData:[]},{type:"daterange",label:"时间",val:[],key:"create_time",hasShortcuts:!0,valueKey:[]}]}),p=Object(r.computed)((function(){return function(e){return e.complete_percent-e.time_percent}}));Object(r.watch)((function(){return s.currentProIds}),(function(e){n.product_id=e,Object(r.nextTick)((function(){y()}))}),{deep:!0,immediate:!0}),Object(r.onMounted)((function(){l()}));var f,O=Object(V.a)(S,n),j=O.getData,h=O.tableData,v=O.stopAutoGetData,g=O.currentPage,y=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==r){e.next=2;break}return e.abrupt("return");case 2:null===(a=t.value)||void 0===a||a.setCurrentPage(),g.value=1,clearTimeout(f),f=setTimeout(Object(k.a)(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({pageSize:n.page_size,pageIndex:1},!0,n);case 2:v.value=!1,r=document.getElementsByClassName("content")[0],a=document.getElementsByClassName("search-header")[0],t.value.height=r.offsetHeight-a.offsetHeight-115;case 6:case"end":return e.stop()}}),e)}))),300);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(B.a)(y,(function(){y()}));var C=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({product_id:s.currentProIds});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({product_id:s.currentProIds});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(){var t,n,r,a,c,o,l,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.currentGroupIds.toString(),d.has("data"+n)){e.next=19;break}return e.next=5,C();case 5:return r=e.sent,e.next=8,E();case 8:if(a=e.sent,!r||!a){e.next=14;break}d.set("data"+n,{staffList:r,demandList:a}),d.set("time",0),e.next=19;break;case 14:if(d.get("time")&&!(d.get("time")<=1)){e.next=19;break}return c=d.get("time")||0,d.set("time",c?++c:1),T(),e.abrupt("return");case 19:if(d.get("data"+n)){e.next=21;break}return e.abrupt("return",F.a.warning("数据异常，请刷新页面"));case 21:o=d.get("data"+n),l=o.staffList,i=o.demandList,m.searchForm[2].listData=null!=l?l:[],m.searchForm[3].listData=null!==(t=null==i?void 0:i.map((function(e){return{value:e.id,label:e.name}})))&&void 0!==t?t:[];case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(_.a)(Object(_.a)({stopAutoGetData:v,sortChange:function(e){var r,a=e.prop,c=e.order;c&&(n.sort_name=a,n.sort_by="ascending"===c?1:2,j(null===(r=t.value)||void 0===r?void 0:r.getCurrentPage(),void 0,n))},onSearchFromClick:T,changeSearch:function(e){Object.keys(n).filter((function(e){return!["sort_name","sort_by","product_id","page_index","page_size"].includes(e)})).forEach((function(t){"start_time"===t&&e.create_time?n.start_time=e.create_time[0]:"end_time"===t&&e.create_time?n.end_time=e.create_time[1]:n[t]=e[t]||void 0})),n.product_id=s.currentProIds,y()},quickSeacrh:function(e){var t;switch(Object.keys(n).filter((function(e){return!["sort_name","sort_by","product_id","page_index","page_size"].includes(e)})).forEach((function(e){n[e]=void 0})),e.key){case"status":n.status=["2"===e.id?Number(e.id):null===(t=e.id.split(","))||void 0===t?void 0:t.map((function(e){return Number(e)}))];break;case"staff_no":n.staff_no=c.staff_no;break;case"month":"4"===e.id?n.month=P()().format("YYYY-MM"):n.month=P()().add(-1,"month").startOf("month").format("YYYY-MM")}n.product_id=s.currentProIds,y()},searchArray:m,curStatus:p,isFullScreen:e,getTextColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"color",n=x.o.find((function(t){return t.value===e}));return Object(w.a)({},t,null==n?void 0:n.color)},getStatus:function(e){var t=x.o.find((function(t){return t.value===e}));return null==t?void 0:t.label},getData:j,handleShowDetail:function(e){R.b.commit(A.a.updateIterateId,null==e?void 0:e.id),R.b.commit(A.a.updateCurrentIter),R.b.commit(A.a.updateProductId,null==e?void 0:e.product_id),N.f.demand=null==e?void 0:e.id;var t=a.resolve({name:"homepage",query:{productId:null==e?void 0:e.product_id,iterateId:N.f.demand}}).href;window.open(t,"_blank")},progressNode:function(e){var t=e.plan?e.plan.create_time:"";return[{time:t,realTime:t},{time:e.dev_time,realTime:e.real_dev_time},{time:e.union_time,realTime:e.real_union_time},{time:e.test_time,realTime:e.real_test_time},{time:e.release_time,realTime:e.real_release_time}]},handleConditionSearch:y,STATUS:x.o},Object(r.toRefs)(h)),{},{searchParams:n,pageTableRef:t,handleClear:function(){n.name="",y()},handleStatus:function(e){e.length||(n.status=[],y())},currentPage:g,tableRowClassName:function(e){var t=e.row,n=t.status,r=t.complete_percent,a=t.time_percent;return 0===n?"no-start":6===n||7===n?"has-end":r-a<0?"delay":"to-do"},currentActive:b})}}),M=(n("8aae"),n("6b0d"));const Y=n.n(M)()(L,[["render",function(e,t,n,a,_,w){var k=Object(r.resolveComponent)("search-form"),y=Object(r.resolveComponent)("el-table-column"),S=Object(r.resolveComponent)("iteration-tip"),C=Object(r.resolveComponent)("progress-bar"),x=Object(r.resolveComponent)("page-table"),N=Object(r.resolveComponent)("FullScreen");return Object(r.openBlock)(),Object(r.createElementBlock)("div",c,[Object(r.createVNode)(x,{tableData:e.list,isFullScreen:e.isFullScreen,tableRowClassName:e.tableRowClassName,onHandlePagationChange:e.getData,total:e.total,currentPage:e.currentPage,onSortChange:e.sortChange,ref:"pageTableRef"},{header:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("div",o,[Object(r.createVNode)(k,{ref:"searchform",onClick:e.onSearchFromClick,searchArray:e.searchArray,onQuickSeacrh:e.quickSeacrh,onChangeSearch:e.changeSearch,currentActive:e.currentActive},null,8,["onClick","searchArray","onQuickSeacrh","onChangeSearch","currentActive"])])]})),main:Object(r.withCtx)((function(){return[Object(r.createVNode)(y,{prop:"product_name",label:"项目",sortable:"custom",fixed:"left","min-width":"100"}),Object(r.createVNode)(y,{prop:"name",label:"版本名称",sortable:"custom",fixed:"left","class-name":"table-column-left table-column-left1","min-width":"150"},{default:Object(r.withCtx)((function(t){return[Object(r.createElementVNode)("span",{class:"version__color",onClick:function(n){return e.handleShowDetail(t.row)}},Object(r.toDisplayString)(t.row.name),9,l)]})),_:1}),Object(r.createVNode)(y,{label:"迭代内容","class-name":"table-column-left",fixed:"left","min-width":"220"},{default:Object(r.withCtx)((function(e){return[(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(e.row.demand,(function(t,n){return Object(r.openBlock)(),Object(r.createElementBlock)("div",{key:n},[e.row.demand.length>1?(Object(r.openBlock)(),Object(r.createElementBlock)("span",i,Object(r.toDisplayString)(n+1)+"、",1)):Object(r.createCommentVNode)("",!0),Object(r.createElementVNode)("span",null,Object(r.toDisplayString)(t.name),1)])})),128))]})),_:1}),Object(r.createVNode)(y,{label:"成员",width:"170",fixed:"left","class-name":"table-column-left"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("div",null,"产品负责人："+Object(r.toDisplayString)(e.row.iteration_manager.staff_name),1),e.row.user_list.length?(Object(r.openBlock)(),Object(r.createElementBlock)("div",u,[s,(Object(r.openBlock)(!0),Object(r.createElementBlock)(r.Fragment,null,Object(r.renderList)(e.row.user_list,(function(t,n){return Object(r.openBlock)(),Object(r.createElementBlock)("span",{key:n},[Object(r.createTextVNode)(Object(r.toDisplayString)(t.staff_name)+" ",1),n!==e.row.user_list.length-1?(Object(r.openBlock)(),Object(r.createElementBlock)("span",d,"，")):Object(r.createCommentVNode)("",!0)])})),128))])):Object(r.createCommentVNode)("",!0)]})),_:1}),Object(r.createVNode)(y,{label:"迭代进度","min-width":"160",fixed:"left",prop:"complete_percent",sortable:"custom"},{default:Object(r.withCtx)((function(t){return[Object(r.createElementVNode)("span",null,[Object(r.createTextVNode)(Object(r.toDisplayString)(t.row.complete_percent)+"%( ",1),t.row.dev_time?(Object(r.openBlock)(),Object(r.createElementBlock)("span",{key:0,class:Object(r.normalizeClass)([e.curStatus(t.row)>=0?"percent percent-green":"percent percent-red"])},Object(r.toDisplayString)(e.curStatus(t.row)>=0?"提前":"落后")+Object(r.toDisplayString)(Math.abs(e.curStatus(t.row)))+"%",3)):(Object(r.openBlock)(),Object(r.createElementBlock)("span",b," 待排期 ")),m])]})),_:1}),Object(r.createVNode)(y,{prop:"status",label:"状态","min-width":"100","class-name":"table-column-center",sortable:"custom"},{default:Object(r.withCtx)((function(t){return[Object(r.createElementVNode)("div",{style:Object(r.normalizeStyle)(e.getTextColor(t.row.status))},[p,f,Object(r.createElementVNode)("span",null,Object(r.toDisplayString)(e.getStatus(t.row.status)),1)],4)]})),_:1}),Object(r.createVNode)(y,{prop:"node",label:"节点时间",resizable:!1,"min-width":"330"},{header:Object(r.withCtx)((function(){return[Object(r.createElementVNode)("div",O,[Object(r.createVNode)(S),j])]})),default:Object(r.withCtx)((function(t){return[Object(r.createElementVNode)("div",null,[Object(r.createVNode)(C,{isShowStart:!1,status:t.row.stage,dataTime:e.progressNode(t.row),class:"progress-padding"},null,8,["status","dataTime"])])]})),_:1}),Object(r.createVNode)(y,{"class-name":"table-column-left",prop:"last_week_summary",label:"上周总结","min-width":"180"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",h,Object(r.toDisplayString)(e.row.last_week_summary||"无"),1)]})),_:1}),Object(r.createVNode)(y,{"class-name":"table-column-left",prop:"week_plan",label:"本周计划","min-width":"180"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",v,Object(r.toDisplayString)(e.row.week_plan||"无"),1)]})),_:1}),Object(r.createVNode)(y,{label:"备注","class-name":"table-column-left",width:"160"},{default:Object(r.withCtx)((function(e){return[Object(r.createElementVNode)("span",g,Object(r.toDisplayString)(e.row.warning||"无"),1)]})),_:1})]})),_:1},8,["tableData","isFullScreen","tableRowClassName","onHandlePagationChange","total","currentPage","onSortChange"]),Object(r.createVNode)(N,{fullscreen:e.isFullScreen,"onUpdate:fullscreen":t[0]||(t[0]=function(t){return e.isFullScreen=t})},null,8,["fullscreen"])])}],["__scopeId","data-v-7e3fea8f"]]);t.default=Y},"71ee":function(e,t,n){"use strict";var r=n("7a23"),a=n("d257"),c=Object(r.defineComponent)({props:{fullscreen:{type:Boolean,default:!1}},emits:["update:fullscreen"],setup:function(e,t){var n=t.emit,c=e,o=function(){return Object(r.createVNode)("span",{class:"fullscreen-icon-global iconfont icon-fullscreen",onClick:l},null)},l=function(){n("update:fullscreen",!c.fullscreen),Object(a.P)(),Object(a.I)((function(e){n("update:fullscreen",e)}))};return function(e,t){return Object(r.openBlock)(),Object(r.createBlock)(o)}}}),o=(n("9a6d"),n("6b0d"));const l=n.n(o)()(c,[["__scopeId","data-v-d63bdac2"]]);t.a=l},"8aae":function(e,t,n){"use strict";n("3fec")},"9a6d":function(e,t,n){"use strict";n("39d7")}}]);