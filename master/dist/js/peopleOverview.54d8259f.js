(window.webpackJsonp=window.webpackJsonp||[]).push([["peopleOverview"],{"3a3a":function(e,t,a){"use strict";function n(e,t){return{response:function(e,t){return{response:function(a){var n=a=a||{pageIndex:1,pageSize:20},r=n.pageIndex,c=n.pageSize;return e&&e(r,c,t)}}}(e,t).response}}a.d(t,"a",(function(){return n}))},"77d9":function(e,t,a){"use strict";a("dbbd")},b539:function(e,t,a){"use strict";a("d91d")},c048:function(e,t,a){"use strict";a("dfe5")},c252:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("1da1");function r(e){return{pagation:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(a);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}a("96cf")},d91d:function(e,t,a){},dbbd:function(e,t,a){},dfe5:function(e,t,a){},ea39:function(e,t,a){"use strict";a.r(t),a("99af");var n=a("7a23"),r={class:"search-header"},c={class:"search-left"},o={class:"search-right"},l={key:0},i={key:1,class:"today-tag"},u=function(e){return Object(n.pushScopeId)("data-v-f5a40cc8"),e=e(),Object(n.popScopeId)(),e}((function(){return Object(n.createElementVNode)("div",{class:"color-description"},[Object(n.createElementVNode)("span",{class:"color-block-1"},"节假日"),Object(n.createElementVNode)("span",{class:"color-block-2"},"有任务"),Object(n.createElementVNode)("span",{class:"color-block-3"},"空闲")],-1)})),d=a("5530"),s=a("1da1"),p=(a("96cf"),a("159b"),a("b64b"),a("caad"),a("a9e3"),a("ac1f"),a("1276"),a("b0c0"),a("5a0c")),f=a.n(p),b=a("2ef0"),m=a("23c4"),h=function(e){return Object(n.pushScopeId)("data-v-5ed6d20d"),e=e(),Object(n.popScopeId)(),e}((function(){return Object(n.createElementVNode)("span",{class:"popover-cell"}," ",-1)})),g={key:0},y={key:1},O={key:2},j={class:"details-header-top"},v={class:"details-header-left"},_={class:"details-header-right"},k=a("81ab"),C=Object(n.defineComponent)({name:"PeopleCell",components:{},props:{type:{type:Number,default:function(){return 0}},rowIndex:{type:Number,default:function(){return 0}},columnIndex:{type:Number,default:function(){return 0}},staffNo:{type:String,default:function(){return""}},staffName:{type:String,default:function(){return""}},certainDay:{type:String,default:function(){return""}},year:{type:String,default:function(){return f()().format("YYYY")}}},emits:["change"],setup:function(e){var t=Object(n.ref)(!1),a=Object(n.reactive)({list:[],date:"",staff_no:"",staffName:"",work_num:0,fixed_bug_num:0,submit_bug_num:0,assigned_bug_num:0,complete_work_num:0}),r=Object(n.ref)(f()().format("MM/DD"));Object(n.onMounted)((function(){c(e.staffNo,e.certainDay)}));var c=function(n,r){t.value=!0,2==e.type&&Object(k.r)({staff_no:n,certain_day:r,year:e.year}).then((function(e){if(200===e.code&&e.data){var n=e.data,r=n.list,c=n.date,o=n.staff_no,l=n.staffName,i=n.work_num,u=n.fixed_bug_num,d=n.submit_bug_num,s=n.assigned_bug_num,p=n.complete_work_num;a.list=r,a.date=c,a.staff_no=o,a.staffName=l,a.work_num=i,a.fixed_bug_num=u,a.submit_bug_num=d,a.assigned_bug_num=s,a.complete_work_num=p}else a={list:[],date:"",staff_no:"",staffName:"",work_num:2,fixed_bug_num:0,submit_bug_num:0,assigned_bug_num:2,complete_work_num:0};t.value=!1}))};return{today:r,loading:t,calendarDetails:a,getDisplayTime:function(e,t){return e&&t?"".concat(e," - ").concat(t):e&&!t?"".concat(e," - ").concat(e):!e&&t?"".concat(t," - ").concat(t):""}}}}),w=(a("77d9"),a("6b0d")),x=a.n(w),S=x()(C,[["render",function(e,t,a,r,c,o){var l=Object(n.resolveComponent)("el-table-column"),i=Object(n.resolveComponent)("el-table"),u=Object(n.resolveComponent)("el-popover"),d=Object(n.resolveDirective)("loading");return Object(n.withDirectives)((Object(n.openBlock)(),Object(n.createBlock)(u,{trigger:"hover",width:2==e.type?750:200,placement:e.rowIndex>5?"top":"bottom"},{reference:Object(n.withCtx)((function(){return[h]})),default:Object(n.withCtx)((function(){var t,a,r,c,o,u,d,s;return[3==e.type?(Object(n.openBlock)(),Object(n.createElementBlock)("span",g,"今天是空闲状态，找点事来做吧")):1==e.type?(Object(n.openBlock)(),Object(n.createElementBlock)("span",y,"今日是休息日哦，要加班吗？")):(Object(n.openBlock)(),Object(n.createElementBlock)("div",O,[Object(n.createElementVNode)("div",j,[Object(n.createElementVNode)("span",v,Object(n.toDisplayString)("".concat(null===(t=e.calendarDetails)||void 0===t?void 0:t.staffName," - ").concat(null===(a=e.calendarDetails)||void 0===a?void 0:a.date)),1),Object(n.createElementVNode)("span",_,Object(n.toDisplayString)("当日统计：")+" "+Object(n.toDisplayString)("计划工作项 ".concat(null===(r=e.calendarDetails)||void 0===r?void 0:r.work_num,"个，"))+" "+Object(n.toDisplayString)("今日完成 ".concat(null===(c=e.calendarDetails)||void 0===c?void 0:c.complete_work_num,"个，"))+" "+Object(n.toDisplayString)("修复BUG ".concat(null===(o=e.calendarDetails)||void 0===o?void 0:o.fixed_bug_num,"个，"))+" "+Object(n.toDisplayString)("新增BUG ".concat(null===(u=e.calendarDetails)||void 0===u?void 0:u.assigned_bug_num,"个，"))+" "+Object(n.toDisplayString)("提交BUG ".concat(null===(d=e.calendarDetails)||void 0===d?void 0:d.submit_bug_num,"个")),1)]),Object(n.createVNode)(i,{data:null===(s=e.calendarDetails)||void 0===s?void 0:s.list,"show-header":!0,border:!0,"max-height":"320"},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(l,{label:"工作",property:"name",align:"left","show-overflow-tooltip":!0}),Object(n.createVNode)(l,{label:"类型",property:"type",width:"60"},{default:Object(n.withCtx)((function(e){return[Object(n.createTextVNode)(Object(n.toDisplayString)(["","需求","任务","BUG"][Number(e.row.type)]),1)]})),_:1}),Object(n.createVNode)(l,{label:"工时",property:"hours",width:"60"}),Object(n.createVNode)(l,{label:"预计起止",property:"start",width:"100"},{default:Object(n.withCtx)((function(e){return[Object(n.createTextVNode)(Object(n.toDisplayString)("".concat(e.row.start," - ").concat(e.row.end)),1)]})),_:1}),Object(n.createVNode)(l,{label:"实际起止",property:"start",width:"100"},{default:Object(n.withCtx)((function(e){return[Object(n.createTextVNode)(Object(n.toDisplayString)("".concat(e.row.real_start," - ").concat(e.row.real_end)),1)]})),_:1}),Object(n.createVNode)(l,{label:"所属项目",property:"product_name"})]})),_:1},8,["data"])]))]})),_:1},8,["width","placement"])),[[d,e.loading]])}],["__scopeId","data-v-5ed6d20d"]]);function N(){return D.apply(this,arguments)}function D(){return(D=Object(s.a)(regeneratorRuntime.mark((function e(){var t,a,n,r,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:1,a=c.length>1&&void 0!==c[1]?c[1]:20,n=c.length>2?c[2]:void 0,e.next=5,Object(k.s)(Object(d.a)(Object(d.a)({},n),{},{pageIndex:t,pageSize:a}));case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=a("913c"),B=a("7085"),Y=a("38d1"),E=a("9fe0"),T=(a("fb6a"),a("c252")),I=a("3a3a"),M=Object(n.defineComponent)({name:"peopleOverview",components:{PeopleCell:S},setup:function(){var e,t=Object(n.ref)(),a=Object(n.ref)(),r=Object(n.computed)((function(){return document.documentElement.clientHeight})),c=Object(n.ref)(!1),o=Object(n.ref)(!1),l=Object(n.ref)([]),i=Object(n.ref)([]),u=Object(n.ref)([]),p=Object(n.ref)([]),h=Object(n.reactive)([]),g=Object(n.ref)(f()().format("MM/DD")),y=Object(n.reactive)({product_id:"",iteration_id:"",department_code:[],staff_name:"",filter_type:2,position_type:[],month:f()().format("YYYY-MM")}),O=[{id:"-1",label:"所有",key:""},{id:"1",label:"我的部门",key:"filter_type"},{id:"2",label:"我的项目",key:"filter_type"},{id:"3",label:"我的岗位",key:"filter_type"},{id:f()().format("YYYY-MM"),label:"本月",key:"month"},{id:f()().subtract(1,"month").format("YYYY-MM"),label:"上月",key:"month"}],j=[{type:"input",label:"姓名",key:"staff_name",val:""},{type:"customComponents",componentIndex:1,label:"部门",val:[],key:"department_code",multiple:!0,valueKey:["value","label"],listData:i},{type:"select",label:"项目",val:[],multiple:!1,key:"product_id",valueKey:["id","name"],listData:u},{type:"select",label:"迭代",multiple:!1,val:[],key:"iteration_id",valueKey:["id","name"],listData:p},{type:"select",label:"岗位",val:[],key:"position_type",multiple:!0,valueKey:["value","label"],listData:m.o}],v=Object(n.reactive)({btnArray:O,searchForm:j}),_=Object(n.ref)("2"),k=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];delete y.filter_type,Object.keys(y).forEach((function(t){["product_id","iteration_id","staff_name"].includes(t)?y[t]="":["department_code","position_type"].includes(t)?y[t]=[]:e&&(y.month=f()().format("YYYY-MM"))}))},C=function(){var a=Object(s.a)(regeneratorRuntime.mark((function a(n){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(e),e=setTimeout(Object(s.a)(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}return e.next=3,S({pageIndex:1,pageSize:20},!0,y);case 3:e.next=8;break;case 5:return a=t.value.getCurrentPage(),e.next=8,S(a,!0,y);case 8:case"end":return e.stop()}}),e)}))),300);case 2:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),w=function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t?t.pageIndex:1,n=t?t.pageSize:20,e.next=4,S({pageIndex:a,pageSize:n},!0,y);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(e,t){var a=Object(n.reactive)({total:0,page:1,pageSize:20,list:[],displayTheader:[],displayTbody:[],employeeCalendarList:[]}),r=(Object(n.ref)(t),Object(n.ref)(!1));return{getData:function(){var t=Object(s.a)(regeneratorRuntime.mark((function t(n,c,o){var l,i,u,d,s,p,f,b,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.displayTbody=[],a.employeeCalendarList=[],a.page=n&&n.pageIndex||1,a.pageSize=n&&n.pageSize||20,r.value=null!=c,l=Object(I.a)(e,o),i=l.response,u=Object(T.a)(i),d=u.pagation,t.next=9,d(n);case 9:s=t.sent,p=s.data,f=p.list,b=p.count,f&&f.length&&(a.displayTheader=f.slice(0,1),1===f.slice(0,1).length&&(a.displayTheader=f.slice(0,1)[0].slice(1)),(m=f.slice(1)).length>0&&(m.forEach((function(e){a.displayTbody.push(e.slice(1))})),a.employeeCalendarList=m)),a.total=b;case 15:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),tableData:a,stopAutoGetData:r}}(N,y),S=x.getData,D=x.tableData,M=function(e){Object(B.a)({product_id:e}).then((function(e){200===e.code&&e.data?p.value=e.data:p.value=[]}))},R=Object(n.reactive)([-1,-1]),P=null,A=null,z=Object(n.ref)(!1),L=function(e,t){if(!(t<=1)){var a=document.querySelector(".el-table__header"),n=null==a?void 0:a.getElementsByClassName("el-table__cell")[t];n&&(n.style.backgroundColor="add"===e?"#22b089":"#fff")}},F=Object(n.ref)(-1);return Object(n.watch)((function(){return D.displayTheader}),(function(e){var t=f()().format("MM/DD");e.forEach((function(e,a){e===t&&(F.value=a,setTimeout((function(){L("add",a)}),1200))})),setTimeout((function(){L("clear",F.value)}),600)}),{deep:!0,immediate:!0}),Object(n.onMounted)((function(){Object(E.d)().then((function(e){200===e.code&&e.data?i.value=function e(t){for(var a=[],n=0;n<t.length;n+=1){var r={};r.value=t[n].department_code,r.label=t[n].name,t[n].son&&t[n].son.length&&(r.children=e(t[n].son)),a.push(r)}return a}(e.data):i.value=[]})),Object(Y.Z)().then((function(e){200===e.code&&e.data?u.value=e.data:u.value=[]})),M(0),C(!0)})),Object(d.a)({days:h,today:g,getData:S,maxHeight:r,clickCell:R,allPeople:i,demandList:V.c,searchArray:v,tableLoading:c,searchParams:y,pageTableRef:t,currentActive:_,selectTreeRef:a,needShowPopover:z,popoverLoading:o,departmentOptions:l,changeDay:function(e){y.month=e,C(!0)},cellClick:function(e,t,a){var n=D.displayTbody;R[0]=Object(b.indexOf)(n,e),R[1]=t.no,P=A,A=a.getElementsByClassName("day")[0],P&&(P.style.backgroundColor=""),A&&t.no>1&&setTimeout((function(){z.value=!0,A.style.backgroundColor="#e6a23c"}),100)},sortChange:function(e){var t=e.prop,a=e.order;a&&(y.sort_name=t,y.sort_by="ascending"===a?1:2,C())},resetSearch:function(){v.searchForm[3].listData=[],M(0)},quickSeacrh:function(e){var t=e.key,a=e.id;switch(k(),t){case"filter_type":y[t]=Number(a);break;case"month":y[t]=a}C(!0)},changeSearch:function(e){k(!1),Object(b.map)(e,(function(e,t){switch(t){case"staff_name":case"product_id":case"iteration_id":case"department_code":y[t]=e;break;case"position_type":y[t]=e||[]}})),C(!0)},searchChange:function(e){"product_id"===e.key&&(v.searchForm[3].val=[],M(e.val))},onCancleSearch:function(){v.btnArray=O,v.searchForm=j},getCellStaffNo:function(e){return D.employeeCalendarList[e][0]},getCellStaffName:function(e){return D.employeeCalendarList[e][1]},getSearchParamsYear:function(){return y.month.split("-")[0]},getCellCertainDay:function(e){return D.displayTheader[e]},handleConditionSearch:C,handlePagationChange:w},Object(n.toRefs)(D))}});a("c048"),a("b539");const R=x()(M,[["render",function(e,t,a,d,s,p){var f=Object(n.resolveComponent)("search-form"),b=Object(n.resolveComponent)("el-date-picker"),m=Object(n.resolveComponent)("el-form-item"),h=Object(n.resolveComponent)("PeopleCell"),g=Object(n.resolveComponent)("el-table-column"),y=Object(n.resolveComponent)("page-table");return Object(n.openBlock)(),Object(n.createElementBlock)("div",null,[Object(n.createVNode)(y,{loading:e.tableLoading,tableData:e.displayTbody,total:e.total,currentPage:e.page,onCellClick:e.cellClick,onSortChange:e.sortChange,onHandlePagationChange:e.handlePagationChange,border:!0,class:"user-calendar-table",ref:"pageTableRef"},{header:Object(n.withCtx)((function(){return[Object(n.createElementVNode)("div",r,[Object(n.createElementVNode)("div",c,[Object(n.createVNode)(f,{searchArray:e.searchArray,currentActive:e.currentActive,onChange:e.searchChange,onQuickSeacrh:e.quickSeacrh,onChangeSearch:e.changeSearch,onOnCancel:e.onCancleSearch,onResetSearch:e.resetSearch},null,8,["searchArray","currentActive","onChange","onQuickSeacrh","onChangeSearch","onOnCancel","onResetSearch"])]),Object(n.createElementVNode)("div",o,[Object(n.createVNode)(m,{label:"选择月份",style:{position:"absolute",right:"32px"}},{default:Object(n.withCtx)((function(){return[Object(n.createVNode)(b,{modelValue:e.searchParams.month,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.searchParams.month=t}),style:{width:"116px"},clearable:!1,onChange:e.changeDay,"value-format":"YYYY-MM",type:"month",placeholder:"选择月"},null,8,["modelValue","onChange"])]})),_:1})])])]})),main:Object(n.withCtx)((function(){return[(Object(n.openBlock)(!0),Object(n.createElementBlock)(n.Fragment,null,Object(n.renderList)(e.displayTheader,(function(t,a){return Object(n.openBlock)(),Object(n.createBlock)(g,{label:t,align:"center","min-width":a<=1?80:40,key:"column".concat(a).concat(e.displayTheader.length),sortable:a<=1&&"custom",prop:"".concat(a<=1?["staff_name","job_name"][a]:a)},{default:Object(n.withCtx)((function(t){return[Object(n.createElementVNode)("div",{class:Object(n.normalizeClass)(["day",{"color-day-1":a>1&&1==t.row[a],"color-day-2":a>1&&2==t.row[a],"color-day-3":a>1&&3==t.row[a]}])},[a<=1?(Object(n.openBlock)(),Object(n.createElementBlock)("span",l,Object(n.toDisplayString)(t.row[a]),1)):Object(n.createCommentVNode)("",!0),e.today==e.getCellCertainDay(a)?(Object(n.openBlock)(),Object(n.createElementBlock)("span",i)):Object(n.createCommentVNode)("",!0),a>1&&e.clickCell[0]==t.$index&&e.clickCell[1]==a?(Object(n.openBlock)(),Object(n.createBlock)(h,{key:2,columnIndex:a,type:t.row[a],rowIndex:t.$index,year:e.getSearchParamsYear(),staffName:e.getCellStaffName(t.$index),staffNo:e.getCellStaffNo(t.$index),certainDay:e.getCellCertainDay(a)},null,8,["columnIndex","type","rowIndex","year","staffName","staffNo","certainDay"])):Object(n.createCommentVNode)("",!0)],2)]})),_:2},1032,["label","min-width","sortable","prop"])})),128))]})),_:1},8,["loading","tableData","total","currentPage","onCellClick","onSortChange","onHandlePagationChange"]),u])}],["__scopeId","data-v-f5a40cc8"]]);t.default=R}}]);